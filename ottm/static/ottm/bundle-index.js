var $r=Object.defineProperty;var fn=s=>{throw TypeError(s)};var Ir=(s,t,e)=>t in s?$r(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var b=(s,t,e)=>Ir(s,typeof t!="symbol"?t+"":t,e),Mi=(s,t,e)=>t.has(s)||fn("Cannot "+e);var n=(s,t,e)=>(Mi(s,t,"read from private field"),e?e.call(s):t.get(s)),p=(s,t,e)=>t.has(s)?fn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),f=(s,t,e,i)=>(Mi(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e),o=(s,t,e)=>(Mi(s,t,"access private method"),e);var ri=(s,t,e,i)=>({set _(r){f(s,t,r,e)},get _(){return n(s,t,i)}});import{$ as $$1}from"./bundle-dep-jquery.js";import{m as maplibreGlExports}from"./bundle-dep-maplibre-gl.js";/*! js-cookie v3.0.5 | MIT */function assign(s){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var i in e)s[i]=e[i]}return s}var defaultConverter={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function init(s,t){function e(r,l,c){if(!(typeof document>"u")){c=assign({},t,c),typeof c.expires=="number"&&(c.expires=new Date(Date.now()+c.expires*864e5)),c.expires&&(c.expires=c.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var u="";for(var h in c)c[h]&&(u+="; "+h,c[h]!==!0&&(u+="="+c[h].split(";")[0]));return document.cookie=r+"="+s.write(l,r)+u}}function i(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var l=document.cookie?document.cookie.split("; "):[],c={},u=0;u<l.length;u++){var h=l[u].split("="),d=h.slice(1).join("=");try{var g=decodeURIComponent(h[0]);if(c[g]=s.read(d,g),r===g)break}catch{}}return r?c[r]:c}}return Object.create({set:e,get:i,remove:function(r,l){e(r,"",assign({},l,{expires:-1}))},withAttributes:function(r){return init(this.converter,assign({},this.attributes,r))},withConverter:function(r){return init(assign({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(s)}})}var api=init(defaultConverter,{path:"/"}),Nt;class Mapping{constructor(t){p(this,Nt);f(this,Nt,t)}get(t){return n(this,Nt)[t]}containsKey(t){return this.get(t)!==void 0}keys(){return Object.keys(n(this,Nt))}values(){return Object.values(n(this,Nt))}entries(){return Object.entries(n(this,Nt))}[Symbol.iterator](){const t=this.entries();let e=-1;return{next:()=>({value:t[++e],done:!(e in t)})}}}Nt=new WeakMap;class Language{constructor(t,e,i,r,l,c,u,h,d,g,v,E){b(this,"code");b(this,"name");b(this,"comma");b(this,"and");b(this,"writingDirection");b(this,"dayNames");b(this,"abbrDayNames");b(this,"monthNames");b(this,"abbrMonthNames");b(this,"ampm");b(this,"decimalSep");b(this,"thousandsSep");if(c.length!==7)throw new Error("dayNames expected 7 values");if(u.length!==7)throw new Error("abbrDayNames expected 7 values");if(h.length!==12)throw new Error("monthNames expected 12 values");if(d.length!==12)throw new Error("abbrMonthNames expected 12 values");this.code=t,this.name=e,this.writingDirection=i,this.comma=r,this.and=l,this.dayNames=c,this.abbrDayNames=u,this.monthNames=h,this.abbrMonthNames=d,this.ampm=g,this.decimalSep=v,this.thousandsSep=E}formatNumber(t){const e=t.toString(),i=e.includes(".")?e.split(".")[1]:"";return Math.floor(t).toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandsSep)+(i?this.decimalSep+i:"")}listToText(t){return t.length===0?"":t.length===1?`${t[0]}`:`${t.slice(0,t.length-1).join(this.comma)}${this.and}${t[t.length-1]}`}}var hi,mn;class OTTM{constructor(){p(this,hi);b(this,"config");b(this,"page");b(this,"user");b(this,"languages");b(this,"translations");b(this,"Mapping",Mapping);b(this,"Language",Language);if(!window.OTTM_CONFIG)throw new Error("Missing global OTTM_CONFIG object");this.config=new Mapping(window.OTTM_CONFIG.config),this.page=new Mapping(window.OTTM_CONFIG.page),this.user=new Mapping(window.OTTM_CONFIG.user),this.translations=new Mapping(window.OTTM_CONFIG.translations);const t={};for(const e of window.OTTM_CONFIG.languages)t[e.code]=new Language(e.code,e.name,e.writingDirection,e.comma,e.and,e.dayNames,e.abbrDayNames,e.monthNames,e.abbrMonthNames,e.ampm,e.decimalSep,e.thousandsSep);this.languages=new Mapping(t),delete window.OTTM_CONFIG,$$1("#ottm-config-script").remove()}translate(t,e,i={}){let r=this.translations.get(t)??(e instanceof Function?e():e)??t;if(r)for(const[l,c]of Object.entries(i))r=r.replace(new RegExp("{"+l+"}","g"),`${c}`);return r}formatShortcut(...t){return t.map(e=>this.translate(`key.${e}`,e.toUpperCase())).join("+")}getPageLanguage(){const t=this.page.get("language");if(typeof t!="string")throw new Error("Missing language");const e=this.languages.get(t);if(!e)throw new Error(`Undefined language "${t}"`);return e}convertDateTimezone(t,e){return new Date(t.toLocaleString("en-US",{timeZone:e}))}formatTime(t){const e=t.getHours().toLocaleString("en-US",{minimumIntegerDigits:2}),i=t.getMinutes().toLocaleString("en-US",{minimumIntegerDigits:2});return`${e}:${i}`}setReferrer(){const t=window.location.pathname+window.location.hash,e=["#nav-login-link","#nav-logout-link"];for(const i of e){const r=$$1(i);r.length&&o(this,hi,mn).call(this,r,t)}}getCookie(t,e){return api.get(t)??e}setCookie(t,e,i){api.set(t,e,i)}deleteCookie(t,e){api.remove(t,e)}}hi=new WeakSet,mn=function(t,e,i){const r=new URL(t.prop("href")),l=new URLSearchParams({return_to:e});if(i)for(const[c,u]of Object.entries(i))l.append(c,u?u.toString():"");r.search=l.toString(),t.attr("href",r.href)};let confirmExitCounter=0;function hookExitConfirm(s){const t={confirmExit:!1,savedState:s.serialize()},e=()=>{t.confirmExit&&(t.confirmExit=!1,confirmExitCounter--,confirmExitCounter===0&&(window.onbeforeunload=null))};$$1("input, textarea, select",s).on("change keyup",()=>{s.serialize()!==t.savedState?t.confirmExit||(t.confirmExit=!0,confirmExitCounter++,window.onbeforeunload=()=>!0):t.confirmExit&&e()}),s.on("submit",e)}function setupUserSettings(){const s=location.hash.substring(1)||"personal-info";$$1(`#form-tab-${s}`).addClass("active"),$$1(`#form-panel-${s}`).addClass("show active"),$$1("#page-content ul[role='tablist'] button[role='tab']").on("click",t=>{location.hash=`#${t.target.id.substring(9)}`}),$$1("#user-settings-form-preferred-timezone").on("change",t=>{const e=$$1(t.target).val();if(typeof e!="string")return;const i=window.ottm.config.get("serverTimezone");if(typeof i!="string")return;const r=new Date,l=window.ottm.formatTime(window.ottm.convertDateTimezone(r,e)),c=$$1("#local-time time");c.text(l),c.attr("datetime",l);const u=window.ottm.formatTime(window.ottm.convertDateTimezone(r,i)),h=$$1("#server-time time");h.text(u),h.attr("datetime",u)})}var pe;class OttmMap extends maplibreGlExports.Map{constructor(){super(...arguments);p(this,pe,!1)}get textFieldHasFocus(){return n(this,pe)}hookTextFieldsFocusEvents(){const e=$$1("input[type='text'], textarea");e.on("focusin",()=>f(this,pe,!0)),e.on("focusout",()=>f(this,pe,!1))}}pe=new WeakMap;function createControlContainer(s){const t=document.createElement("div");return t.classList.add("maplibregl-ctrl","maplibregl-ctrl-group",s),t}function createControlButton(s={}){const t=document.createElement("button");if(s.title&&(t.title=s.title),s.shortcut&&(t.title+=" ["+window.ottm.formatShortcut(...s.shortcut)+"]"),s.icon&&t.appendChild(s.icon),s.textContent&&(t.textContent=s.textContent),s.disabled&&(t.disabled=!0),s.hidden&&(t.hidden=!0),s.className&&t.classList.add(s.className),s.onClick){const e=s.onClick;t.addEventListener("click",()=>{e(t)})}return t}function createMdiIcon(s,t={}){const e=document.createElement("span");return e.className=`mdi mdi-${s} mdi-${t.size??18}px`,t.rotate&&e.classList.add(`mdi-rotate-${t.rotate}`),t.flip&&e.classList.add(`mdi-flip-${t.flip}`),t.spin&&e.classList.add("mdi-spin"),t.color&&e.classList.add(`mdi-${t.color}`),t.inactive&&e.classList.add("mdi-inactive"),e}function parseSVG(s){return new DOMParser().parseFromString(s,"image/svg+xml").firstChild}const ICON=parseSVG(`
<svg viewBox="0 0 24 24" width="22" height="22" xmlns="http://www.w3.org/2000/svg">
  <g fill="none" fill-rule="evenodd">
    <path d="M0 0h24v24H0z"/>
    <path fill="#f44336" d="M12 3l4 8H8z"/>
    <path fill="#9E9E9E" d="M12 21l-4-8h8z"/>
  </g>
</svg>
`);var Lt,Kt,yt,_e,ze,oe,yn,ki;class CompassControl{constructor(t={}){p(this,oe);p(this,Lt);p(this,Kt);p(this,yt);p(this,_e);p(this,ze);f(this,Kt,{...t}),f(this,yt,createControlContainer("maplibregl-ctrl-compass")),f(this,ze,ICON),f(this,_e,createControlButton({title:n(this,Kt).title??"Compass",icon:ICON,onClick:()=>{o(this,oe,yn).call(this)}}))}onAdd(t){return f(this,Lt,t),n(this,Kt).instant||(n(this,yt).hidden=!0),n(this,yt).appendChild(n(this,_e)),o(this,oe,ki).call(this),n(this,Lt).on("rotate",()=>{o(this,oe,ki).call(this)}),n(this,yt)}onRemove(){var t;(t=n(this,yt).parentNode)==null||t.removeChild(n(this,yt))}}Lt=new WeakMap,Kt=new WeakMap,yt=new WeakMap,_e=new WeakMap,ze=new WeakMap,oe=new WeakSet,yn=function(){n(this,Lt)&&n(this,Lt).easeTo({bearing:0,pitch:0})},ki=function(){if(!n(this,Lt))return;const t=-n(this,Lt).getBearing();n(this,Kt).instant||(n(this,yt).hidden=t===0),n(this,ze).style.transform=`rotate(${t}deg)`};function capitalize(s){return s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}var ui,Yt,Rt,rt,xt,st,Ne,Re,X,Z,wn,Fi,vn,bn,Sn,$i,Ii;const di=class di{constructor(t){p(this,Z);p(this,Yt);p(this,Rt);p(this,rt);p(this,xt);p(this,st);p(this,Ne);p(this,Re);p(this,X);f(this,rt,{...t}),f(this,xt,createControlContainer("maplibregl-ctrl-geocoder")),f(this,st,document.createElement("input")),n(this,st).type="text",n(this,st).placeholder=n(this,rt).placeholderText??"Search",n(this,st).accessKey="f",n(this,st).onkeyup=e=>{e.key==="Enter"&&o(this,Z,Fi).call(this)},n(this,st).oninput=()=>{o(this,Z,Ii).call(this)},f(this,Ne,createControlButton({title:n(this,rt).eraseButtonTitle??"Erase",icon:createMdiIcon("close"),onClick:()=>{o(this,Z,wn).call(this)}})),f(this,Re,createControlButton({title:n(this,rt).searchButtonTitle??"Go",icon:createMdiIcon("magnify"),onClick:()=>{o(this,Z,Fi).call(this)}})),f(this,X,document.createElement("div")),n(this,X).className="maplibregl-ctrl-geocoder-results-panel",n(this,X).style.display="none"}onAdd(t){f(this,Yt,t);const e=document.createElement("div");return e.className="maplibregl-ctrl-geocoder-search-bar",e.appendChild(n(this,Re)),e.appendChild(n(this,st)),e.appendChild(n(this,Ne)),n(this,xt).appendChild(e),n(this,xt).appendChild(n(this,X)),n(this,xt)}onRemove(){var t;(t=n(this,xt).parentNode)==null||t.removeChild(n(this,xt))}};ui=new WeakMap,Yt=new WeakMap,Rt=new WeakMap,rt=new WeakMap,xt=new WeakMap,st=new WeakMap,Ne=new WeakMap,Re=new WeakMap,X=new WeakMap,Z=new WeakSet,wn=function(){o(this,Z,Ii).call(this),n(this,st).value="",n(this,st).focus()},Fi=function(){const t=n(this,st).value.trim();if(t){const e=n(di,ui).replace("{query}",encodeURIComponent(t)).replace("{lang}",encodeURIComponent(n(this,rt).language));$$1.get(e).done(i=>{o(this,Z,vn).call(this,i)}).fail(()=>{o(this,Z,bn).call(this)})}},vn=function(t){if(n(this,X).replaceChildren(),t.length===0)n(this,X).textContent=n(this,rt).noResultsMessage??"No results.";else{const e=document.createElement("ul"),i="```";for(const r of t){const l=r.type,c=r.category;let u=n(this,rt).translator(`osm_feature_type.prefix.${c}.${l}`,()=>i+capitalize(l.replace("_"," ")));c==="boundary"&&l==="administrative"&&(u=n(this,rt).translator(`osm_feature_type.prefix.place.${r.addresstype}`,()=>{const E=Math.floor((r.place_rank+1)/2);return n(this,rt).translator(`osm_feature_type.admin_levels.level${E}`,u)}));const h=document.createElement("li");if(u.includes(i)){const E=document.createElement("em");E.appendChild(document.createTextNode(u.slice(i.length))),h.appendChild(E)}else h.appendChild(document.createTextNode(u));h.appendChild(document.createTextNode(" – "));const d=document.createElement("a");d.textContent=r.display_name,d.href="#";const g=r.boundingbox,v=[{lat:g[0],lng:g[2]},{lat:g[1],lng:g[3]}];d.onclick=()=>{o(this,Z,Sn).call(this,r.lat,r.lon,v)},h.appendChild(d),e.appendChild(h)}n(this,X).appendChild(e)}o(this,Z,$i).call(this)},bn=function(){n(this,X).replaceChildren(),n(this,X).textContent=n(this,rt).errorMessage??"An error occured.",o(this,Z,$i).call(this)},Sn=function(t,e,i){var r;n(this,Yt)&&((r=n(this,Rt))==null||r.remove(),n(this,Yt).fitBounds(i),f(this,Rt,new maplibreGlExports.Marker({})),n(this,Rt).setLngLat({lat:t,lng:e}),n(this,Rt).addTo(n(this,Yt)))},$i=function(){n(this,X).style.display="block"},Ii=function(){var t;(t=n(this,Rt))==null||t.remove(),n(this,X).style.display="none",n(this,X).replaceChildren()},p(di,ui,"https://nominatim.openstreetmap.org/search?q={query}&format=jsonv2&accept-language={lang}");let GeocoderControl=di;var Q,Qt,Tt,pt,Et,En,Pn,Cn,Ln;class TilesSourcesControl{constructor(t){p(this,Et);p(this,Q);p(this,Qt);p(this,Tt);p(this,pt);f(this,Qt,{...t}),f(this,Tt,createControlContainer("maplibregl-ctrl-tiles-sources")),f(this,pt,document.createElement("div")),n(this,pt).style.display="none"}onAdd(t){return f(this,Q,t),o(this,Et,Pn).call(this),n(this,Tt)}onRemove(){var t;(t=n(this,Tt).parentNode)==null||t.removeChild(n(this,Tt))}}Q=new WeakMap,Qt=new WeakMap,Tt=new WeakMap,pt=new WeakMap,Et=new WeakSet,En=function(t){const e=n(this,Qt).sources.find(i=>i.id===t);if(!e)throw Error(`Can’t find tiles source with ID ${t}`);return e},Pn=function(){if(!n(this,Q))throw Error("map is undefined");const t=createControlButton({title:n(this,Qt).title??"Backgrounds",icon:createMdiIcon("layers-outline"),onClick:()=>{n(this,pt).style.display==="none"?n(this,pt).style.display="block":n(this,pt).style.display="none"}});n(this,Q).on("click",()=>n(this,pt).style.display="none"),n(this,Tt).appendChild(t),n(this,Tt).appendChild(n(this,pt));const e=document.createElement("ul");n(this,pt).append(e),n(this,Qt).sources.forEach(i=>{const r=document.createElement("input");r.type="radio",r.name="tiles-sources",r.value=i.id,r.id=i.id,r.onchange=u=>{o(this,Et,Cn).call(this,u)};const l=document.createElement("label");l.textContent=i.label,l.htmlFor=i.id;const c=document.createElement("li");c.append(r," ",l),e.appendChild(c)}),n(this,Q).on("load",()=>{if(!n(this,Q))return;const i=n(this,Q).getSource("tiles")._options.id;document.getElementById(i).checked=!0})},Cn=function(t){const e=t.target.value;o(this,Et,Ln).call(this,o(this,Et,En).call(this,e))},Ln=function(t){n(this,Q)&&(n(this,Q).removeLayer("tiles"),n(this,Q).removeSource("tiles"),n(this,Q).addSource("tiles",t.source),n(this,Q).addLayer({id:"tiles",type:"raster",source:"tiles"}),n(this,Q).fire("controls.styles.tiles_changed",{type:"tiles",target:n(this,Q),originalEvent:null,source:t}))};var Xt,Vt,Ve,Ae,De,pi,xn;class OpenExternalMapControl{constructor(t){p(this,pi);p(this,Xt);p(this,Vt);p(this,Ve);p(this,Ae);p(this,De);f(this,Vt,createControlContainer("maplibregl-ctrl-open-location")),f(this,Ve,t.urlPattern),f(this,Ae,t.zoomMapping??Number.toString);const e=document.createElement("img");e.src=t.iconUrl,f(this,De,createControlButton({title:t.buttonTitle,icon:e,onClick:()=>{o(this,pi,xn).call(this)}}))}onAdd(t){return f(this,Xt,t),n(this,Vt).appendChild(n(this,De)),n(this,Vt)}onRemove(){var t;(t=n(this,Vt).parentNode)==null||t.removeChild(n(this,Vt))}}Xt=new WeakMap,Vt=new WeakMap,Ve=new WeakMap,Ae=new WeakMap,De=new WeakMap,pi=new WeakSet,xn=function(){if(!n(this,Xt))return;const{lat:t,lng:e}=n(this,Xt).getCenter(),i=n(this,Xt).getZoom();window.open(n(this,Ve).replace("{lat}",t.toFixed(5)).replace("{lng}",e.toFixed(5)).replace("{zoom}",n(this,Ae).call(this,i)))};const PLUS_ICON=parseSVG(`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor">
  <rect fill="none" height="24" width="24"/>
  <path d="M18,13h-5v5c0,0.55-0.45,1-1,1l0,0c-0.55,0-1-0.45-1-1v-5H6c-0.55,0-1-0.45-1-1l0,0c0-0.55,0.45-1,1-1h5V6 c0-0.55,0.45-1,1-1l0,0c0.55,0,1,0.45,1,1v5h5c0.55,0,1,0.45,1,1l0,0C19,12.55,18.55,13,18,13z"/>
</svg>
`),MINUS_ICON=parseSVG(`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="currentColor">
  <rect fill="none" height="24" width="24"/>
  <path d="M18,13H6c-0.55,0-1-0.45-1-1l0,0c0-0.55,0.45-1,1-1h12c0.55,0,1,0.45,1,1l0,0C19,12.55,18.55,13,18,13z"/>
</svg>
`);var At,Ot,ge,fe;class ZoomControl{constructor(t={}){p(this,At);p(this,Ot);p(this,ge);p(this,fe);f(this,Ot,createControlContainer("maplibregl-ctrl-zoom")),f(this,ge,createControlButton({title:t.zoomInTitle??"Zoom In",icon:PLUS_ICON,onClick:()=>{var e;return(e=n(this,At))==null?void 0:e.zoomIn()},shortcut:["+"]})),f(this,fe,createControlButton({title:t.zoomOutTitle??"Zoom Out",icon:MINUS_ICON,onClick:()=>{var e;return(e=n(this,At))==null?void 0:e.zoomOut()},shortcut:["-"]}))}setZoomInButtonDisabled(t){n(this,ge).disabled=t}setZoomOutButtonDisabled(t){n(this,fe).disabled=t}onAdd(t){return f(this,At,t),n(this,Ot).appendChild(n(this,ge)),n(this,Ot).appendChild(n(this,fe)),$$1(t.getContainer()).on("keydown",e=>{if(!(n(this,At)instanceof OttmMap&&n(this,At).textFieldHasFocus))switch(e.key){case"+":t.zoomIn();break;case"-":t.zoomOut();break}}),n(this,Ot)}onRemove(){var t;(t=n(this,Ot).parentNode)==null||t.removeChild(n(this,Ot))}}At=new WeakMap,Ot=new WeakMap,ge=new WeakMap,fe=new WeakMap;var global=typeof window<"u"?window:null,ssr=global===null,document$1=ssr?void 0:global.document,addEventListener="addEventListener",removeEventListener="removeEventListener",getBoundingClientRect="getBoundingClientRect",gutterStartDragging="_a",aGutterSize="_b",bGutterSize="_c",HORIZONTAL="horizontal",NOOP=function(){return!1},calc=ssr?"calc":["","-webkit-","-moz-","-o-"].filter(function(s){var t=document$1.createElement("div");return t.style.cssText="width:"+s+"calc(9px)",!!t.style.length}).shift()+"calc",isString=function(s){return typeof s=="string"||s instanceof String},elementOrSelector=function(s){if(isString(s)){var t=document$1.querySelector(s);if(!t)throw new Error("Selector "+s+" did not match a DOM element");return t}return s},getOption=function(s,t,e){var i=s[t];return i!==void 0?i:e},getGutterSize=function(s,t,e,i){if(t){if(i==="end")return 0;if(i==="center")return s/2}else if(e){if(i==="start")return 0;if(i==="center")return s/2}return s},defaultGutterFn=function(s,t){var e=document$1.createElement("div");return e.className="gutter gutter-"+t,e},defaultElementStyleFn=function(s,t,e){var i={};return isString(t)?i[s]=t:i[s]=calc+"("+t+"% - "+e+"px)",i},defaultGutterStyleFn=function(s,t){var e;return e={},e[s]=t+"px",e},Split=function(s,t){if(t===void 0&&(t={}),ssr)return{};var e=s,i,r,l,c,u,h;Array.from&&(e=Array.from(e));var d=elementOrSelector(e[0]),g=d.parentNode,v=getComputedStyle?getComputedStyle(g):null,E=v?v.flexDirection:null,M=getOption(t,"sizes")||e.map(function(){return 100/e.length}),w=getOption(t,"minSize",100),I=Array.isArray(w)?w:e.map(function(){return w}),U=getOption(t,"maxSize",1/0),A=Array.isArray(U)?U:e.map(function(){return U}),W=getOption(t,"expandToMin",!1),G=getOption(t,"gutterSize",10),J=getOption(t,"gutterAlign","center"),tt=getOption(t,"snapOffset",30),ti=Array.isArray(tt)?tt:e.map(function(){return tt}),Ti=getOption(t,"dragInterval",1),ae=getOption(t,"direction",HORIZONTAL),Oi=getOption(t,"cursor",ae===HORIZONTAL?"col-resize":"row-resize"),Pr=getOption(t,"gutter",defaultGutterFn),cn=getOption(t,"elementStyle",defaultElementStyleFn),Cr=getOption(t,"gutterStyle",defaultGutterStyleFn);ae===HORIZONTAL?(i="width",r="clientX",l="left",c="right",u="clientWidth"):ae==="vertical"&&(i="height",r="clientY",l="top",c="bottom",u="clientHeight");function Le(S,m,y,C){var K=cn(i,m,y,C);Object.keys(K).forEach(function(B){S.style[B]=K[B]})}function Lr(S,m,y){var C=Cr(i,m,y);Object.keys(C).forEach(function(K){S.style[K]=C[K]})}function ei(){return h.map(function(S){return S.size})}function hn(S){return"touches"in S?S.touches[0][r]:S[r]}function un(S){var m=h[this.a],y=h[this.b],C=m.size+y.size;m.size=S/this.size*C,y.size=C-S/this.size*C,Le(m.element,m.size,this[aGutterSize],m.i),Le(y.element,y.size,this[bGutterSize],y.i)}function xr(S){var m,y=h[this.a],C=h[this.b];this.dragging&&(m=hn(S)-this.start+(this[aGutterSize]-this.dragOffset),Ti>1&&(m=Math.round(m/Ti)*Ti),m<=y.minSize+y.snapOffset+this[aGutterSize]?m=y.minSize+this[aGutterSize]:m>=this.size-(C.minSize+C.snapOffset+this[bGutterSize])&&(m=this.size-(C.minSize+this[bGutterSize])),m>=y.maxSize-y.snapOffset+this[aGutterSize]?m=y.maxSize+this[aGutterSize]:m<=this.size-(C.maxSize-C.snapOffset+this[bGutterSize])&&(m=this.size-(C.maxSize+this[bGutterSize])),un.call(this,m),getOption(t,"onDrag",NOOP)(ei()))}function dn(){var S=h[this.a].element,m=h[this.b].element,y=S[getBoundingClientRect](),C=m[getBoundingClientRect]();this.size=y[i]+C[i]+this[aGutterSize]+this[bGutterSize],this.start=y[l],this.end=y[c]}function Tr(S){if(!getComputedStyle)return null;var m=getComputedStyle(S);if(!m)return null;var y=S[u];return y===0?null:(ae===HORIZONTAL?y-=parseFloat(m.paddingLeft)+parseFloat(m.paddingRight):y-=parseFloat(m.paddingTop)+parseFloat(m.paddingBottom),y)}function pn(S){var m=Tr(g);if(m===null||I.reduce(function(B,nt){return B+nt},0)>m)return S;var y=0,C=[],K=S.map(function(B,nt){var Zt=m*B/100,ii=getGutterSize(G,nt===0,nt===S.length-1,J),ni=I[nt]+ii;return Zt<ni?(y+=ni-Zt,C.push(0),ni):(C.push(Zt-ni),Zt)});return y===0?S:K.map(function(B,nt){var Zt=B;if(y>0&&C[nt]-y>0){var ii=Math.min(y,C[nt]-y);y-=ii,Zt=B-ii}return Zt/m*100})}function Or(){var S=this,m=h[S.a].element,y=h[S.b].element;S.dragging&&getOption(t,"onDragEnd",NOOP)(ei()),S.dragging=!1,global[removeEventListener]("mouseup",S.stop),global[removeEventListener]("touchend",S.stop),global[removeEventListener]("touchcancel",S.stop),global[removeEventListener]("mousemove",S.move),global[removeEventListener]("touchmove",S.move),S.stop=null,S.move=null,m[removeEventListener]("selectstart",NOOP),m[removeEventListener]("dragstart",NOOP),y[removeEventListener]("selectstart",NOOP),y[removeEventListener]("dragstart",NOOP),m.style.userSelect="",m.style.webkitUserSelect="",m.style.MozUserSelect="",m.style.pointerEvents="",y.style.userSelect="",y.style.webkitUserSelect="",y.style.MozUserSelect="",y.style.pointerEvents="",S.gutter.style.cursor="",S.parent.style.cursor="",document$1.body.style.cursor=""}function Mr(S){if(!("button"in S&&S.button!==0)){var m=this,y=h[m.a].element,C=h[m.b].element;m.dragging||getOption(t,"onDragStart",NOOP)(ei()),S.preventDefault(),m.dragging=!0,m.move=xr.bind(m),m.stop=Or.bind(m),global[addEventListener]("mouseup",m.stop),global[addEventListener]("touchend",m.stop),global[addEventListener]("touchcancel",m.stop),global[addEventListener]("mousemove",m.move),global[addEventListener]("touchmove",m.move),y[addEventListener]("selectstart",NOOP),y[addEventListener]("dragstart",NOOP),C[addEventListener]("selectstart",NOOP),C[addEventListener]("dragstart",NOOP),y.style.userSelect="none",y.style.webkitUserSelect="none",y.style.MozUserSelect="none",y.style.pointerEvents="none",C.style.userSelect="none",C.style.webkitUserSelect="none",C.style.MozUserSelect="none",C.style.pointerEvents="none",m.gutter.style.cursor=Oi,m.parent.style.cursor=Oi,document$1.body.style.cursor=Oi,dn.call(m),m.dragOffset=hn(S)-m.end}}M=pn(M);var qt=[];h=e.map(function(S,m){var y={element:elementOrSelector(S),size:M[m],minSize:I[m],maxSize:A[m],snapOffset:ti[m],i:m},C;if(m>0&&(C={a:m-1,b:m,dragging:!1,direction:ae,parent:g},C[aGutterSize]=getGutterSize(G,m-1===0,!1,J),C[bGutterSize]=getGutterSize(G,!1,m===e.length-1,J),E==="row-reverse"||E==="column-reverse")){var K=C.a;C.a=C.b,C.b=K}if(m>0){var B=Pr(m,ae,y.element);Lr(B,G,m),C[gutterStartDragging]=Mr.bind(C),B[addEventListener]("mousedown",C[gutterStartDragging]),B[addEventListener]("touchstart",C[gutterStartDragging]),g.insertBefore(B,y.element),C.gutter=B}return Le(y.element,y.size,getGutterSize(G,m===0,m===e.length-1,J),m),m>0&&qt.push(C),y});function gn(S){var m=S.i===qt.length,y=m?qt[S.i-1]:qt[S.i];dn.call(y);var C=m?y.size-S.minSize-y[bGutterSize]:S.minSize+y[aGutterSize];un.call(y,C)}h.forEach(function(S){var m=S.element[getBoundingClientRect]()[i];m<S.minSize&&(W?gn(S):S.minSize=m)});function kr(S){var m=pn(S);m.forEach(function(y,C){if(C>0){var K=qt[C-1],B=h[K.a],nt=h[K.b];B.size=m[C-1],nt.size=y,Le(B.element,B.size,K[aGutterSize],B.i),Le(nt.element,nt.size,K[bGutterSize],nt.i)}})}function Fr(S,m){qt.forEach(function(y){if(m!==!0?y.parent.removeChild(y.gutter):(y.gutter[removeEventListener]("mousedown",y[gutterStartDragging]),y.gutter[removeEventListener]("touchstart",y[gutterStartDragging])),S!==!0){var C=cn(i,y.a.size,y[aGutterSize]);Object.keys(C).forEach(function(K){h[y.a].element.style[K]="",h[y.b].element.style[K]=""})}})}return{setSizes:kr,getSizes:ei,collapse:function(m){gn(h[m])},destroy:Fr,parent:g,pairs:qt}},earthRadius=63710088e-1,factors={centimeters:earthRadius*100,centimetres:earthRadius*100,degrees:360/(2*Math.PI),feet:earthRadius*3.28084,inches:earthRadius*39.37,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:earthRadius*1e3,millimetres:earthRadius*1e3,nauticalmiles:earthRadius/1852,radians:1,yards:earthRadius*1.0936};function feature(s,t,e={}){const i={type:"Feature"};return(e.id===0||e.id)&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.properties=t||{},i.geometry=s,i}function point(s,t,e={}){if(!s)throw new Error("coordinates is required");if(!Array.isArray(s))throw new Error("coordinates must be an Array");if(s.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(s[0])||!isNumber(s[1]))throw new Error("coordinates must contain numbers");return feature({type:"Point",coordinates:s},t,e)}function polygon(s,t,e={}){for(const r of s){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<r[r.length-1].length;l++)if(r[r.length-1][l]!==r[0][l])throw new Error("First and last Position are not equivalent.")}return feature({type:"Polygon",coordinates:s},t,e)}function lineString(s,t,e={}){if(s.length<2)throw new Error("coordinates must be an array of two or more positions");return feature({type:"LineString",coordinates:s},t,e)}function featureCollection(s,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=s,e}function multiLineString(s,t,e={}){return feature({type:"MultiLineString",coordinates:s},t,e)}function radiansToLength(s,t="kilometers"){const e=factors[t];if(!e)throw new Error(t+" units is invalid");return s*e}function lengthToRadians(s,t="kilometers"){const e=factors[t];if(!e)throw new Error(t+" units is invalid");return s/e}function bearingToAzimuth(s){let t=s%360;return t<0&&(t+=360),t}function radiansToDegrees(s){return s%(2*Math.PI)*180/Math.PI}function degreesToRadians(s){return s%360*Math.PI/180}function isNumber(s){return!isNaN(s)&&s!==null&&!Array.isArray(s)}function isObject(s){return s!==null&&typeof s=="object"&&!Array.isArray(s)}function coordEach(s,t,e){if(s!==null)for(var i,r,l,c,u,h,d,g=0,v=0,E,M=s.type,w=M==="FeatureCollection",I=M==="Feature",U=w?s.features.length:1,A=0;A<U;A++){d=w?s.features[A].geometry:I?s.geometry:s,E=d?d.type==="GeometryCollection":!1,u=E?d.geometries.length:1;for(var W=0;W<u;W++){var G=0,J=0;if(c=E?d.geometries[W]:d,c!==null){h=c.coordinates;var tt=c.type;switch(g=0,tt){case null:break;case"Point":if(t(h,v,A,G,J)===!1)return!1;v++,G++;break;case"LineString":case"MultiPoint":for(i=0;i<h.length;i++){if(t(h[i],v,A,G,J)===!1)return!1;v++,tt==="MultiPoint"&&G++}tt==="LineString"&&G++;break;case"Polygon":case"MultiLineString":for(i=0;i<h.length;i++){for(r=0;r<h[i].length-g;r++){if(t(h[i][r],v,A,G,J)===!1)return!1;v++}tt==="MultiLineString"&&G++,tt==="Polygon"&&J++}tt==="Polygon"&&G++;break;case"MultiPolygon":for(i=0;i<h.length;i++){for(J=0,r=0;r<h[i].length;r++){for(l=0;l<h[i][r].length-g;l++){if(t(h[i][r][l],v,A,G,J)===!1)return!1;v++}J++}G++}break;case"GeometryCollection":for(i=0;i<c.geometries.length;i++)if(coordEach(c.geometries[i],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function geomEach(s,t){var e,i,r,l,c,u,h,d,g,v,E=0,M=s.type==="FeatureCollection",w=s.type==="Feature",I=M?s.features.length:1;for(e=0;e<I;e++){for(u=M?s.features[e].geometry:w?s.geometry:s,d=M?s.features[e].properties:w?s.properties:{},g=M?s.features[e].bbox:w?s.bbox:void 0,v=M?s.features[e].id:w?s.id:void 0,h=u?u.type==="GeometryCollection":!1,c=h?u.geometries.length:1,r=0;r<c;r++){if(l=h?u.geometries[r]:u,l===null){if(t(null,E,d,g,v)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,E,d,g,v)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<l.geometries.length;i++)if(t(l.geometries[i],E,d,g,v)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function geomReduce(s,t,e){var i=e;return geomEach(s,function(r,l,c,u,h){l===0&&e===void 0?i=r:i=t(i,r,l,c,u,h)}),i}function flattenEach(s,t){geomEach(s,function(e,i,r,l,c){var u=e===null?null:e.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return t(feature(e,r,{bbox:l,id:c}),i,0)===!1?!1:void 0}var h;switch(u){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var d=0;d<e.coordinates.length;d++){var g=e.coordinates[d],v={type:h,coordinates:g};if(t(feature(v,r),i,d)===!1)return!1}})}function segmentEach(s,t){flattenEach(s,function(e,i,r){var l=0;if(e.geometry){var c=e.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var u,h=0,d=0,g=0;if(coordEach(e,function(v,E,M,w,I){if(u===void 0||i>h||w>d||I>g){u=v,h=i,d=w,g=I,l=0;return}var U=lineString([u,v],e.properties);if(t(U,i,r,I,l)===!1)return!1;l++,u=v})===!1)return!1}}})}function segmentReduce(s,t,e){var i=e,r=!1;return segmentEach(s,function(l,c,u,h,d){r===!1&&e===void 0?i=l:i=t(i,l,c,u,h,d),r=!0}),i}function area(s){return geomReduce(s,(t,e)=>t+calculateArea(e),0)}function calculateArea(s){let t=0,e;switch(s.type){case"Polygon":return polygonArea(s.coordinates);case"MultiPolygon":for(e=0;e<s.coordinates.length;e++)t+=polygonArea(s.coordinates[e]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function polygonArea(s){let t=0;if(s&&s.length>0){t+=Math.abs(ringArea(s[0]));for(let e=1;e<s.length;e++)t-=Math.abs(ringArea(s[e]))}return t}var FACTOR=earthRadius*earthRadius/2,PI_OVER_180=Math.PI/180;function ringArea(s){const t=s.length-1;if(t<=2)return 0;let e=0,i=0;for(;i<t;){const r=s[i],l=s[i+1===t?0:i+1],c=s[i+2>=t?(i+2)%t:i+2],u=r[0]*PI_OVER_180,h=l[1]*PI_OVER_180,d=c[0]*PI_OVER_180;e+=(d-u)*Math.sin(h),i++}return e*FACTOR}function getCoord(s){if(!s)throw new Error("coord is required");if(!Array.isArray(s)){if(s.type==="Feature"&&s.geometry!==null&&s.geometry.type==="Point")return[...s.geometry.coordinates];if(s.type==="Point")return[...s.coordinates]}if(Array.isArray(s)&&s.length>=2&&!Array.isArray(s[0])&&!Array.isArray(s[1]))return[...s];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function getCoords(s){if(Array.isArray(s))return s;if(s.type==="Feature"){if(s.geometry!==null)return s.geometry.coordinates}else if(s.coordinates)return s.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function getGeom(s){return s.type==="Feature"?s.geometry:s}function bearing(s,t,e={}){if(e.final===!0)return calculateFinalBearing(s,t);const i=getCoord(s),r=getCoord(t),l=degreesToRadians(i[0]),c=degreesToRadians(r[0]),u=degreesToRadians(i[1]),h=degreesToRadians(r[1]),d=Math.sin(c-l)*Math.cos(h),g=Math.cos(u)*Math.sin(h)-Math.sin(u)*Math.cos(h)*Math.cos(c-l);return radiansToDegrees(Math.atan2(d,g))}function calculateFinalBearing(s,t){let e=bearing(t,s);return e=(e+180)%360,e}function rhumbBearing(s,t,e={}){let i;return e.final?i=calculateRhumbBearing(getCoord(t),getCoord(s)):i=calculateRhumbBearing(getCoord(s),getCoord(t)),i>180?-(360-i):i}function calculateRhumbBearing(s,t){const e=degreesToRadians(s[1]),i=degreesToRadians(t[1]);let r=degreesToRadians(t[0]-s[0]);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);const l=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(e/2+Math.PI/4)),c=Math.atan2(r,l);return(radiansToDegrees(c)+360)%360}function angle(s,t,e,i={}){if(!isObject(i))throw new Error("options is invalid");if(!s)throw new Error("startPoint is required");if(!t)throw new Error("midPoint is required");if(!e)throw new Error("endPoint is required");const r=s,l=t,c=e,u=bearingToAzimuth(i.mercator!==!0?bearing(r,l):rhumbBearing(r,l)),h=bearingToAzimuth(i.mercator!==!0?bearing(c,l):rhumbBearing(c,l)),d=Math.abs(u-h);return i.explementary===!0?360-d:d}function distance(s,t,e={}){var i=getCoord(s),r=getCoord(t),l=degreesToRadians(r[1]-i[1]),c=degreesToRadians(r[0]-i[0]),u=degreesToRadians(i[1]),h=degreesToRadians(r[1]),d=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(u)*Math.cos(h);return radiansToLength(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),e.units)}function length(s,t={}){return segmentReduce(s,(e,i)=>{const r=i.geometry.coordinates;return e+distance(r[0],r[1],t)},0)}function copyLngLat(s){return maplibreGlExports.LngLat.convert(s.toArray())}function isSecondaryClick(s){return s.button===2}const $e=class $e{constructor(t,e){b(this,"lng");b(this,"lat");this.lng=t,this.lat=e}static sub(t,e){return new $e(t.lng-e.lng,t.lat-e.lat)}addTo(t){return new maplibreGlExports.LngLat(t.lng+this.lng,t.lat+this.lat)}};b($e,"ZERO",new $e(0,0));let LngLatVector=$e;var SelectionMode=(s=>(s[s.NONE=0]="NONE",s[s.SELECTED=1]="SELECTED",s[s.HOVERED=2]="HOVERED",s))(SelectionMode||{});class MapFeature{constructor(t,e,i,r,l,c){b(this,"type","Feature");b(this,"geometry");b(this,"properties");b(this,"id");b(this,"dbId");b(this,"dataObject_",null);b(this,"dataTypesProvider");if(this.id=t,this.dbId=r??null,this.geometry=i,this.properties={color:"#ffffff",layer:0,selectionMode:0},this.dataTypesProvider=e,c){const u=this.geometry.type,h=c.type.getGeometryType();if(h!==u)throw new TypeError(`Invalid data object geometry type: expected "${u}", got "${h}"`);this.dataObject_=c}this.layer=l??0}get dataObject(){return this.dataObject_}get color(){return this.properties.color}get layer(){return this.properties.layer}set layer(t){this.properties.layer=t}get selectionMode(){return this.properties.selectionMode}set selectionMode(t){this.properties.selectionMode=t}copyDataOf(t){if(!t.dataObject)return;const e=this.geometry.type,i=t.dataObject.type.getGeometryType();if(e!==i)throw new TypeError(`Invalid geometry type: expected "${e}", got "${i}"`);this.dataObject_=t.dataObject,this.updateProperties()}}var Dt,wt;class Point extends MapFeature{constructor(e,i,r,l,c,u){super(e,i,{type:"Point",coordinates:[]},l,c,u);p(this,Dt);p(this,wt,new Set);this.lngLat=r,this.updateProperties()}get lngLat(){return copyLngLat(n(this,Dt))}set lngLat(e){f(this,Dt,copyLngLat(e)),this.updateGeometry()}get radius(){return this.properties.radius}set radius(e){if(e<1)throw new Error(`Point radius is too small: ${e}`);this.properties.radius=e}get boundFeatures(){return[...n(this,wt)]}bindFeature(e){n(this,wt).add(e),this.updateProperties()}unbindFeature(e){n(this,wt).delete(e),this.updateProperties()}onDrag(e,i=LngLatVector.ZERO){f(this,Dt,i.addTo(e)),this.updateGeometry()}updateGeometry(){this.geometry.coordinates=n(this,Dt).toArray();const{lng:e,lat:i}=n(this,Dt);this.geometry.bbox=[e,i,e,i],n(this,wt).forEach(r=>{r.onVertexDrag(this)})}updateProperties(){this.properties.color=n(this,wt).size>1?"#bbbbbb":"#ffffff",this.dataObject?this.properties.radius=6:n(this,wt).size===0||n(this,wt).size===1&&[...this.boundFeatures].every(e=>e instanceof LineString&&e.isEndVertex(this))?this.properties.radius=5:this.properties.radius=3.5}}Dt=new WeakMap,wt=new WeakMap;const de=class de extends MapFeature{onVertexDrag(t){this.updateGeometry(t)}isNearlyCircular(t){return 4*Math.PI*this.getArea(t)/this.getPerimeter(t)**2>=de.CIRCULARITY_THRESHOLD}getArea(t){return getPolygonArea(this.getRing(t))}getPerimeter(t){return getPolygonPerimeter(this.getRing(t))}isNearlySquare(t){const e=this.getRing(t);for(let i=0;i<e.length;i++){const r=i==0?e[e.length-1]:e[i-1],l=e[i],c=i==e.length-1?e[0]:e[i+1],u=angle(r,l,c,{mercator:!0})%90,h=de.RIGHT_ANGLE_THRESHOLD;if(u>h&&u<90-h)return!1}return!0}};b(de,"CIRCULARITY_THRESHOLD",.6),b(de,"RIGHT_ANGLE_THRESHOLD",5);let LinearFeature=de;var PolylineDirection=(s=>(s[s.FORWARD=0]="FORWARD",s[s.BACKWARD=1]="BACKWARD",s))(PolylineDirection||{}),gi,x,Ge,gt,Pt;const fi=class fi extends LinearFeature{constructor(e,i,r,l,c,u){super(e,i,{type:"LineString",coordinates:[]},l,c,u);p(this,gt);p(this,x,[]);p(this,Ge,0);if(r){if(r.length<2)throw new Error(`Expected at least 2 points, got ${r.length} in linestring ${l}`);for(let h=0;h<r.length;h++){const d=r[h],g=h.toString();if(!this.canAppendVertex(d,g))throw new Error(`Cannot append vertex ${d.id} at ${g}`);this.appendVertex(d,g)}}this.updateProperties()}get vertices(){return[...n(this,x)]}get width(){return this.properties.width}get direction(){return n(this,Ge)}set direction(e){f(this,Ge,e)}isEmpty(){return n(this,x).length===0}canAppendVertex(e,i){if(!this.canAcceptVertex(e))return!1;const r=o(this,gt,Pt).call(this,i);return r!==null&&(r===0||r===n(this,x).length)}appendVertex(e,i){this.canAppendVertex(e,i)&&(o(this,gt,Pt).call(this,i)===0?n(this,x).unshift(e):n(this,x).push(e),e.bindFeature(this),this.updateGeometry())}canAcceptVertex(e,i){const r=n(this,x).indexOf(e);if(r===-1)return!0;if(!i||this.isLoop())return!1;const l=o(this,gt,Pt).call(this,i);if(l===null||Math.abs(r-l)<=2)return!1;const c=n(this,x).length-1;return r===0&&l===c||r===c&&l===0}replaceVertex(e,i){if(!this.canAcceptVertex(e,this.getVertexPath(i)))return;let r=n(this,x).indexOf(i);do n(this,x)[r]=e,r=n(this,x).indexOf(i);while(r!==-1);e.bindFeature(this),i.unbindFeature(this),this.updateGeometry()}canInsertVertex(e,i){if(!this.canAcceptVertex(e))return!1;const r=o(this,gt,Pt).call(this,i);return r!==null&&r<n(this,x).length-1}insertVertexAfter(e,i){if(!this.canInsertVertex(e,i))return;const r=o(this,gt,Pt).call(this,i);r!==null&&(n(this,x).splice(r+1,0,e),e.bindFeature(this),this.updateGeometry())}removeVertex(e){let i=n(this,x).indexOf(e);if(i!==-1){if(n(this,x).length<=2||this.isLoop()&&n(this,x).length===3)return{type:"delete_feature"};do n(this,x).splice(i,1),i=n(this,x).indexOf(e);while(i!==-1);e.unbindFeature(this),this.updateGeometry()}return{type:"do_nothing"}}getVertex(e){const i=o(this,gt,Pt).call(this,e);return i!==null&&i<n(this,x).length?n(this,x)[i]:null}getSegmentVertices(e){const i=o(this,gt,Pt).call(this,e);return i!==null&&i<n(this,x).length-1?[n(this,x)[i],n(this,x)[i+1]]:null}incrementPath(e){const i=o(this,gt,Pt).call(this,e);return i!==null?((i+1)%n(this,x).length).toString():null}getSegmentPath(e,i){const r=n(this,x).indexOf(e),l=n(this,x).indexOf(i);if(r!==-1&&l!==-1){if(r===l-1)return r.toString();if(l===r-1)return l.toString()}return null}getVertexPath(e){const i=n(this,x).indexOf(e);return i!==-1?i.toString():null}getNextVertexPath(){return n(this,x).length.toString()}isEndVertex(e){if(this.isLoop())return!1;const i=n(this,x).indexOf(e);return i===0||i===n(this,x).length-1}isLoop(){return n(this,x).length>1&&n(this,x)[0]===n(this,x)[n(this,x).length-1]}isNearlyCircular(e){return this.isLoop()&&super.isNearlyCircular(e)}getArea(e){if(!this.isLoop())throw new Error("LineString is not a loop");return super.getArea(e)}getPerimeter(e){if(!this.isLoop())throw new Error("LineString is not a loop");return super.getPerimeter(e)}isNearlySquare(e){return this.isLoop()&&super.isNearlySquare(e)}getRing(e){if(e!==0)throw new Error(`Invalid ring index: ${e}`);return n(this,x).slice(0,n(this,x).length-1)}isNearlyStraight(){return!1}updateGeometry(e){this.geometry.coordinates=[];let i=1/0,r=1/0,l=-1/0,c=-1/0;for(const u of n(this,x)){const{lng:h,lat:d}=u.lngLat;this.geometry.coordinates.push([h,d]),i=Math.min(h,i),r=Math.min(d,r),l=Math.max(h,l),c=Math.max(d,c)}this.geometry.bbox=[i,r,l,c],e?e.updateProperties():n(this,x).forEach(u=>{u.updateProperties()})}updateProperties(){if(!this.dataObject)this.properties.width=2,this.properties.color="#ffffff",this.properties.dash=null,this.properties.fgColor="#ffffff",this.properties.fgWidth=0,this.properties.fgDash=null;else if(this.dataObject.isInstanceOf(this.dataTypesProvider("track_section","ObjectType"))){this.properties.width=6,this.dataObject.isInstanceOf(this.dataTypesProvider("conventional_track_section","ObjectType"))&&this.dataObject.getPropertyValues("gauges").some(l=>l>=1435)&&(this.properties.width=8),this.properties.dash=null,this.properties.fgWidth=2,this.properties.fgDash=[4,4];let e;switch(this.dataObject.getPropertyValue("level")){case"bridge":e="#131313";break;case"tunnel":e="#9b9b9b";break;case"surface":default:e="#3d3d3d";break}this.properties.color=e,this.properties.fgColor="#ffffff"}}};gi=new WeakMap,x=new WeakMap,Ge=new WeakMap,gt=new WeakSet,Pt=function(e){const i=n(fi,gi).exec(e);return i?+i[1]:null},p(fi,gi,/^(\d+)$/);let LineString=fi;var mi,O,Gt,vt,It;const yi=class yi extends LinearFeature{constructor(e,i,r,l,c,u){super(e,i,{type:"Polygon",coordinates:[[]]},l,c,u);p(this,vt);p(this,O,[]);p(this,Gt,[]);if(r){for(let h=0;h<r.length;h++){const d=r[h];if(d.length<3)throw new Error(`Expected at least 3 points, got ${d.length} in ring ${h} of polygon ${l}`)}for(let h=0;h<r.length;h++){const d=r[h];for(let g=0;g<d.length;g++){const v=d[g],E=`${h}.${g}`;if(!this.canAppendVertex(v,E))throw new Error(`Cannot append vertex ${v.id} at ${E}`);this.appendVertex(v,E)}this.lockRing(h),d.forEach(g=>{g.updateProperties()})}}else n(this,Gt).push(!1);this.updateProperties()}get vertices(){const e=[];for(const i of n(this,O))e.push([...i]);return e}isRingLocked(e){return n(this,Gt)[e]??!1}lockRing(e){typeof n(this,Gt)[e]<"u"&&(n(this,Gt)[e]=!0)}isEmpty(){return!n(this,O)[0]||n(this,O)[0].length===0}canAppendVertex(e,i){const r=o(this,vt,It).call(this,i);return!this.canAcceptVertex(e)||r===null||this.isRingLocked(r[0])?!1:r[0]<n(this,O).length&&(r[1]===0||r[1]===n(this,O)[r[0]].length)||r[0]===n(this,O).length&&r[1]===0}appendVertex(e,i){if(!this.canAppendVertex(e,i))return;const r=o(this,vt,It).call(this,i);if(r===null)return;const[l,c]=r;let u;l===n(this,O).length?(n(this,O).push(u=[]),n(this,Gt).push(!1)):u=n(this,O)[l],c===0?u.unshift(e):u.push(e),e.bindFeature(this),this.updateGeometry()}canAcceptVertex(e){return!n(this,O).some(i=>i.includes(e))}replaceVertex(e,i){if(this.canAcceptVertex(e))for(const r of n(this,O)){const l=r.indexOf(i);if(l!==-1){r[l]=e,e.bindFeature(this),i.unbindFeature(this),this.updateGeometry();return}}}canInsertVertex(e,i){if(!this.canAcceptVertex(e))return!1;const r=o(this,vt,It).call(this,i);return r!==null&&r[0]<n(this,O).length&&r[1]<n(this,O)[r[0]].length}insertVertexAfter(e,i){if(!this.canInsertVertex(e,i))return;const r=o(this,vt,It).call(this,i);if(r===null)return;const[l,c]=r;e.bindFeature(this);const u=n(this,O)[l];c===u.length-1?u.push(e):u.splice(c+1,0,e),this.updateGeometry()}removeVertex(e){for(let i=0;i<n(this,O).length;i++){const r=n(this,O)[i],l=r.indexOf(e);if(l!==-1)return r.length<=3?i===0?{type:"delete_feature"}:{type:"delete_ring",ringIndex:i,points:r}:(r.splice(l,1),e.unbindFeature(this),this.updateGeometry(),{type:"do_nothing"})}return{type:"do_nothing"}}getVertex(e){const i=o(this,vt,It).call(this,e);return i!==null&&i[0]<n(this,O).length&&i[1]<n(this,O)[i[0]].length?n(this,O)[i[0]][i[1]]:null}getSegmentVertices(e){const i=o(this,vt,It).call(this,e);if(i!==null&&i[0]<n(this,O).length&&i[1]<n(this,O)[i[0]].length){const r=n(this,O)[i[0]];return[r[i[1]],r[(i[1]+1)%r.length]]}else return null}incrementPath(e){const i=o(this,vt,It).call(this,e);return i!==null&&i[0]<n(this,O).length?`${i[0]}.${(i[1]+1)%n(this,O)[i[0]].length}`:null}getSegmentPath(e,i){for(const r of n(this,O)){const l=r.indexOf(e),c=r.indexOf(i);if(l!==-1&&c!==-1){if(l===c-1)return l.toString();if(c===l-1)return c.toString();break}else if(l===-1&&c!==-1||l!==-1&&c===-1)break}return null}getVertexPath(e){for(let i=0;i<n(this,O).length;i++){const r=n(this,O)[i].indexOf(e);if(r!==-1)return`${i}.${r}`}return null}getNextVertexPath(){var e;return`0.${((e=n(this,O)[0])==null?void 0:e.length)??0}`}deleteRing(e){0<e&&e<n(this,O).length&&(n(this,O)[e].forEach(i=>{i.unbindFeature(this)}),n(this,O).splice(e,1),this.updateGeometry())}getRing(e){const i=n(this,O)[e];if(typeof i<"u")throw new Error(`Invalid ring index: ${e}`);return[...i]}updateGeometry(e){this.geometry.coordinates=[];let i=1/0,r=1/0,l=-1/0,c=-1/0;for(const u of n(this,O)){const h=[];for(const d of u){const{lng:g,lat:v}=d.lngLat;h.push([g,v]),i=Math.min(g,i),r=Math.min(v,r),l=Math.max(g,l),c=Math.max(v,c)}h.push(u[0].lngLat.toArray()),this.geometry.coordinates.push(h)}this.geometry.bbox=[i,r,l,c],e?e.updateProperties():n(this,O).forEach(u=>{u.forEach(h=>{h.updateProperties()})})}updateProperties(){}};mi=new WeakMap,O=new WeakMap,Gt=new WeakMap,vt=new WeakSet,It=function(e){const i=n(yi,mi).exec(e);return i?[+i[1],+i[2]]:null},p(yi,mi,/^(\d+)\.(\d+)$/);let Polygon=yi;function getPolygonArea(s){return area(toPolygon(s))}function getPolygonPerimeter(s){return length(toPolygon(s),{units:"meters"})}function toPolygon(s){return polygon([[...s,s[0]].map(t=>t.lngLat.toArray())])}var Be;class UnitType{constructor(t,e){b(this,"label");b(this,"localizedName");p(this,Be,new Set);this.label=t,this.localizedName=e}get units(){return new Set(n(this,Be))}addUnit(t){if(t.type!==this)throw new TypeError(`Invalid unit type: expected "${this.label}", got "${t.type.label}"`);n(this,Be).add(t)}}Be=new WeakMap;class Unit{constructor(t,e){b(this,"type");b(this,"symbol");this.type=t,this.symbol=e}}var me;class Enum{constructor(t,e,i){b(this,"label");b(this,"localizedName");p(this,me);if(this.label=t,this.localizedName=e,f(this,me,{...i}),this.values.length===0)throw new Error(`Empty enumeration "${t}"`)}get values(){return Object.keys(n(this,me))}get valuesTranslations(){return Object.entries(n(this,me))}}me=new WeakMap;var je,ye,wi,Tn;class ObjectType{constructor(t,e,i=null,r=null,l=!1,c=!1){p(this,wi);b(this,"label");b(this,"localizedName");b(this,"parentType");b(this,"isDeprecated");b(this,"isTemporal");p(this,je);p(this,ye,new Map);this.label=t,this.localizedName=e,this.parentType=i,this.isTemporal=l,this.isDeprecated=c,f(this,je,r)}get properties(){return o(this,wi,Tn).call(this).flatMap(t=>[...t.values()])}getProperty(t){const e=n(this,ye).get(t);return!e&&this.parentType?this.parentType.getProperty(t):e??null}addProperty(t){if(t.objectType!==this)throw new TypeError(`Expected type "${this.label}", got "${t.objectType.label}"`);if(this.getProperty(t.label))throw new Error(`Object type ${this.label} already has a property named "${t.label}"`);n(this,ye).set(t.label,t)}isSameOrSubtypeOf(t){var e;return this===t||(((e=this.parentType)==null?void 0:e.isSameOrSubtypeOf(t))??!1)}getGeometryType(){var t;return n(this,je)??((t=this.parentType)==null?void 0:t.getGeometryType())??null}}je=new WeakMap,ye=new WeakMap,wi=new WeakSet,Tn=function(){const t=[];let e=this;do t.splice(0,0,n(e,ye)),e=e.parentType;while(e);return t};class ObjectProperty{constructor(t,e,i,r,l){b(this,"objectType");b(this,"fullName");b(this,"label");b(this,"localizedName");b(this,"isUnique");b(this,"isDeprecated");this.objectType=t,this.fullName=`${t.label}.${e}`,this.label=e,this.localizedName=i,this.isUnique=r,this.isDeprecated=l}isValueCompatible(t){return this.label===t.propertyType.label&&this.isUnique===t.propertyType.isUnique&&(!t.propertyType.isUnique&&t.values.every(e=>this.isValueValid(e))||t.propertyType.isUnique&&this.isValueValid(t.value))}}var ft,it,si,xe,_i;class PropertyValue{constructor(t,...e){p(this,it);b(this,"propertyType");p(this,ft,[]);if(this.propertyType=t,e.length===0)throw new Error(`Missing value for property ${this.propertyType.fullName}`);if(t.isUnique){if(e.length!==1)throw new Error(`Property ${this.propertyType.fullName} expected 1 value, got ${e.length}`);this.value=e[0]}else this.values=e}get value(){return o(this,it,_i).call(this),n(this,ft)[0]}set value(t){o(this,it,_i).call(this),o(this,it,si).call(this,t),n(this,ft)[0]=t}get values(){return o(this,it,xe).call(this),[...n(this,ft)]}set values(t){o(this,it,xe).call(this),n(this,ft).splice(0,n(this,ft).length,...t)}addValue(t){o(this,it,xe).call(this),o(this,it,si).call(this,t),n(this,ft).push(t)}removeValue(t){o(this,it,xe).call(this),o(this,it,si).call(this,t);const e=n(this,ft).indexOf(t);e!==-1&&n(this,ft).splice(e,1)}}ft=new WeakMap,it=new WeakSet,si=function(t){if(!this.propertyType.isValueValid(t))throw new Error(`Invalid value for property "${this.propertyType.fullName}"`)},xe=function(){if(this.propertyType.isUnique)throw new TypeError(`Property "${this.propertyType.fullName}" is unique`)},_i=function(){if(!this.propertyType.isUnique)throw new TypeError(`Property "${this.propertyType.fullName}" is not unique`)};class NumberProperty extends ObjectProperty{constructor(e,i,r,l,c,u,h,d){super(e,i,r,l,c);b(this,"min");b(this,"max");b(this,"unitType");if(typeof u=="number"&&typeof h=="number"&&u>h)throw new Error("min > max");this.min=u??null,this.max=h??null,this.unitType=d??null}isValueValid(e){return typeof e=="number"&&(this.min===null||e>=this.min)&&(this.max===null||e<=this.max)}}class FloatProperty extends NumberProperty{newValue(t,e){return new FloatPropertyValue(this,e,t)}}class StringProperty extends ObjectProperty{constructor(e,i,r,l,c,u,h){super(e,i,r,l,c);b(this,"multiline");b(this,"translatable");this.multiline=u,this.translatable=h}isValueValid(e){return typeof e=="string"&&(this.multiline||!e.includes(`
`)&&!e.includes("\r"))}newValue(e,i){return new StringPropertyValue(this,i?[i]:[],e)}}class EnumProperty extends ObjectProperty{constructor(e,i,r,l,c,u){super(e,i,r,l,c);b(this,"enumType");this.enumType=u}isValueValid(e){return typeof e=="string"&&this.enumType.values.some(i=>i===e)}newValue(e){return new EnumPropertyValue(this,e)}}var mt,Ue,bt,Y,at,zi,He,Ni;const Ie=class Ie{constructor(t,e,i){p(this,Y);b(this,"id");p(this,mt);p(this,Ue,null);p(this,bt,new Map);f(this,mt,t),this.id=i??null,this.existenceInterval=e??null}get type(){return n(this,mt)}set type(t){var e;if(t!==n(this,mt)){const i=n(this,mt).getGeometryType(),r=t.getGeometryType();if(i!==r)throw new TypeError(`Incompatible geometry type, expected "${i}", got "${r}"`);const l={};for(const[c,u]of n(this,bt))(e=t.getProperty(c))!=null&&e.isValueCompatible(u)&&(l[c]=u);n(this,bt).clear();for(const[c,u]of Object.entries(l))if(u.propertyType.isUnique)this.setPropertyValue(c,u.value);else for(const h of u.values)this.addValueToProperty(c,h);f(this,mt,t)}}get existenceInterval(){return n(this,Ue)}set existenceInterval(t){if(!this.type.isTemporal&&t)throw new Error("Object is not temporal");if(this.type.isTemporal&&!t)throw new Error("Missing existence interval for temporal object");f(this,Ue,t)}getPropertyValue(t){const{value:e}=o(this,Y,at).call(this,t);return e==null?void 0:e.value}setPropertyValue(t,e){const{property:i,value:r}=o(this,Y,at).call(this,t);r?r.value=e:o(this,Y,zi).call(this,i,e,t)}getPropertyValues(t){const{value:e}=o(this,Y,at).call(this,t);return(e==null?void 0:e.values)??[]}addValueToProperty(t,e){const{property:i,value:r}=o(this,Y,at).call(this,t);r?r.addValue(e):o(this,Y,zi).call(this,i,e,t)}removeValueFromProperty(t,e){const{value:i}=o(this,Y,at).call(this,t);i&&(i.removeValue(e),i.values.length===0&&n(this,bt).delete(t))}deleteProperty(t){const{value:e}=o(this,Y,at).call(this,t);e&&n(this,bt).delete(t)}getPropertyUnit(t){var r;const{property:e,value:i}=o(this,Y,at).call(this,t);if(!(e instanceof NumberProperty)||i&&!o(r=Ie,He,Ni).call(r,i)||!e.unitType)throw new TypeError(`Property "${e.fullName}" does not have a unit`);return(i==null?void 0:i.unit)??null}setPropertyUnit(t,e){var l;const{property:i,value:r}=o(this,Y,at).call(this,t);if(!(i instanceof NumberProperty)||r&&!o(l=Ie,He,Ni).call(l,r)||!i.unitType)throw new TypeError(`Property "${i.fullName}" does not have a unit`);if(!r)throw new Error(`Property "${i.fullName}" is not bound yet`);r.unit=e}getPropertyValueTranslations(t,e){const{property:i,value:r}=o(this,Y,at).call(this,t);if(!(i instanceof StringProperty)||r&&!(r instanceof StringPropertyValue)||!i.translatable)throw new TypeError(`Property "${i.fullName}" is not translatable`);return(r==null?void 0:r.translations[e??0])??null}setPropertyValueTranslation(t,e,i,r){const{property:l,value:c}=o(this,Y,at).call(this,t);if(!(l instanceof StringProperty)||c&&!(c instanceof StringPropertyValue)||!l.translatable)throw new TypeError(`Property "${l.fullName}" is not translatable`);c==null||c.setTranslation(e,i,r)}removePropertyValueTranslation(t,e,i){const{property:r,value:l}=o(this,Y,at).call(this,t);if(!(r instanceof StringProperty)||l&&!(l instanceof StringPropertyValue)||!r.translatable)throw new TypeError(`Property "${r.fullName}" is not translatable`);l==null||l.removeTranslation(e,i)}isInstanceOf(t){return n(this,mt).isSameOrSubtypeOf(t)}};mt=new WeakMap,Ue=new WeakMap,bt=new WeakMap,Y=new WeakSet,at=function(t){const e=n(this,mt).getProperty(t);if(!e)throw new TypeError(`Undefined property "${t}" for object of type "${n(this,mt).label}"`);return{property:e,value:n(this,bt).get(t)}},zi=function(t,e,i){var r;if(t instanceof NumberProperty){if(typeof e!="number")throw new TypeError(`Expected number, got ${typeof e}`);n(this,bt).set(i,t.newValue(e,(r=t.unitType)==null?void 0:r.units.values().next().value))}else n(this,bt).set(i,t.newValue(e))},He=new WeakSet,Ni=function(t){return t instanceof NumberPropertyValue},p(Ie,He);let ObjectInstance=Ie;var qe;class NumberPropertyValue extends PropertyValue{constructor(e,i,...r){super(e,...r);p(this,qe,null);if(e.unitType&&!i)throw new Error(`Missing unit for property ${e.fullName}`);i&&(this.unit=i)}get unit(){return n(this,qe)}set unit(e){const i=this.propertyType.unitType;if(!i)throw new TypeError(`Unexpected unit for property "${this.propertyType.fullName}"`);const r=e.type;if(i!==r)throw new TypeError(`Invalid unit type for property "${this.propertyType.fullName}": expected "${i.label}", got "${r}"`);f(this,qe,e)}}qe=new WeakMap;class FloatPropertyValue extends NumberPropertyValue{}var Jt,we,oi;class StringPropertyValue extends PropertyValue{constructor(e,i,...r){super(e,...r);p(this,we);p(this,Jt);if(i&&o(this,we,oi).call(this),i&&i.length>r.length)throw new Error("Too many translations");f(this,Jt,(i==null?void 0:i.map(l=>new Map(Object.entries(l))))??[])}get translations(){return structuredClone(n(this,Jt))}setTranslation(e,i,r){o(this,we,oi).call(this),n(this,Jt)[r??0].set(e,i)}removeTranslation(e,i){o(this,we,oi).call(this),n(this,Jt)[i??0].delete(e)}}Jt=new WeakMap,we=new WeakSet,oi=function(){if(!this.propertyType.translatable)throw new Error(`Property "${this.propertyType.fullName}" is not translatable`)};class EnumPropertyValue extends PropertyValue{}class MapEditorEvent{constructor(t){b(this,"type");this.type=t}}const vi=class vi extends MapEditorEvent{constructor(e=[]){super(vi.TYPE);b(this,"features");this.features=e}};b(vi,"TYPE","editor.selection");let FeatureSelectionEvent=vi;const bi=class bi extends MapEditorEvent{constructor(e){super(bi.TYPE);b(this,"feature");this.feature=e}};b(bi,"TYPE","editor.hover");let FeatureHoverEvent=bi;function polygonToLine(s,t={}){const e=getGeom(s);switch(!t.properties&&s.type==="Feature"&&(t.properties=s.properties),e.type){case"Polygon":return singlePolygonToLine(e,t);case"MultiPolygon":return multiPolygonToLine(e,t);default:throw new Error("invalid poly")}}function singlePolygonToLine(s,t={}){const i=getGeom(s).coordinates,r=t.properties?t.properties:s.type==="Feature"?s.properties:{};return coordsToLine(i,r)}function multiPolygonToLine(s,t={}){const i=getGeom(s).coordinates,r=t.properties?t.properties:s.type==="Feature"?s.properties:{},l=[];return i.forEach(c=>{l.push(coordsToLine(c,r))}),featureCollection(l)}function coordsToLine(s,t){return s.length>1?multiLineString(s,t):lineString(s[0],t)}function destination(s,t,e,i={}){const r=getCoord(s),l=degreesToRadians(r[0]),c=degreesToRadians(r[1]),u=degreesToRadians(e),h=lengthToRadians(t,i.units),d=Math.asin(Math.sin(c)*Math.cos(h)+Math.cos(c)*Math.sin(h)*Math.cos(u)),g=l+Math.atan2(Math.sin(u)*Math.sin(h)*Math.cos(c),Math.cos(h)-Math.sin(c)*Math.sin(d)),v=radiansToDegrees(g),E=radiansToDegrees(d);return point([v,E],i.properties)}class TinyQueue{constructor(t=[],e=defaultCompare){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,r=e[t];for(;t>0;){const l=t-1>>1,c=e[l];if(i(r,c)>=0)break;e[t]=c,t=l}e[t]=r}_down(t){const{data:e,compare:i}=this,r=this.length>>1,l=e[t];for(;t<r;){let c=(t<<1)+1,u=e[c];const h=c+1;if(h<this.length&&i(e[h],u)<0&&(c=h,u=e[h]),i(u,l)>=0)break;e[t]=u,t=c}e[t]=l}}function defaultCompare(s,t){return s<t?-1:s>t?1:0}function checkWhichEventIsLeft(s,t){return s.p.x>t.p.x?1:s.p.x<t.p.x?-1:s.p.y!==t.p.y?s.p.y>t.p.y?1:-1:1}function checkWhichSegmentHasRightEndpointFirst(s,t){return s.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:s.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:s.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?s.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class Event{constructor(t,e,i,r){this.p={x:t[0],y:t[1]},this.featureId=e,this.ringId=i,this.eventId=r,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}function fillEventQueue(s,t){if(s.type==="FeatureCollection"){const e=s.features;for(let i=0;i<e.length;i++)processFeature(e[i],t)}else processFeature(s,t)}let featureId=0,ringId=0,eventId=0;function processFeature(s,t){const e=s.type==="Feature"?s.geometry:s;let i=e.coordinates;(e.type==="Polygon"||e.type==="MultiLineString")&&(i=[i]),e.type==="LineString"&&(i=[[i]]);for(let r=0;r<i.length;r++)for(let l=0;l<i[r].length;l++){let c=i[r][l][0],u=null;ringId=ringId+1;for(let h=0;h<i[r][l].length-1;h++){u=i[r][l][h+1];const d=new Event(c,featureId,ringId,eventId),g=new Event(u,featureId,ringId,eventId+1);d.otherEvent=g,g.otherEvent=d,checkWhichEventIsLeft(d,g)>0?(g.isLeftEndpoint=!0,d.isLeftEndpoint=!1):(d.isLeftEndpoint=!0,g.isLeftEndpoint=!1),t.push(d),t.push(g),c=u,eventId=eventId+1}}featureId=featureId+1}class Segment{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function testSegmentIntersect(s,t){if(s===null||t===null||s.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(s.rightSweepEvent.isSamePoint(t.leftSweepEvent)||s.rightSweepEvent.isSamePoint(t.leftSweepEvent)||s.rightSweepEvent.isSamePoint(t.rightSweepEvent)||s.leftSweepEvent.isSamePoint(t.leftSweepEvent)||s.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const e=s.leftSweepEvent.p.x,i=s.leftSweepEvent.p.y,r=s.rightSweepEvent.p.x,l=s.rightSweepEvent.p.y,c=t.leftSweepEvent.p.x,u=t.leftSweepEvent.p.y,h=t.rightSweepEvent.p.x,d=t.rightSweepEvent.p.y,g=(d-u)*(r-e)-(h-c)*(l-i),v=(h-c)*(i-u)-(d-u)*(e-c),E=(r-e)*(i-u)-(l-i)*(e-c);if(g===0)return!1;const M=v/g,w=E/g;if(M>=0&&M<=1&&w>=0&&w<=1){const I=e+M*(r-e),U=i+M*(l-i);return[I,U]}return!1}function runCheck(s,t){t=t||!1;const e=[],i=new TinyQueue([],checkWhichSegmentHasRightEndpointFirst);for(;s.length;){const r=s.pop();if(r.isLeftEndpoint){const l=new Segment(r);for(let c=0;c<i.data.length;c++){const u=i.data[c];if(t&&u.leftSweepEvent.featureId===r.featureId)continue;const h=testSegmentIntersect(l,u);h!==!1&&e.push(h)}i.push(l)}else r.isLeftEndpoint===!1&&i.pop()}return e}function sweeplineIntersections$1(s,t){const e=new TinyQueue([],checkWhichEventIsLeft);return fillEventQueue(s,e),runCheck(e,t)}var sweeplineIntersections=sweeplineIntersections$1;function lineIntersect(s,t,e={}){const{removeDuplicates:i=!0,ignoreSelfIntersections:r=!1}=e;let l=[];s.type==="FeatureCollection"?l=l.concat(s.features):s.type==="Feature"?l.push(s):(s.type==="LineString"||s.type==="Polygon"||s.type==="MultiLineString"||s.type==="MultiPolygon")&&l.push(feature(s)),t.type==="FeatureCollection"?l=l.concat(t.features):t.type==="Feature"?l.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&l.push(feature(t));const c=sweeplineIntersections(featureCollection(l),r);let u=[];if(i){const h={};c.forEach(d=>{const g=d.join(",");h[g]||(h[g]=!0,u.push(d))})}else u=c;return featureCollection(u.map(h=>point(h)))}var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(s,t,e)=>t in s?__defProp(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,__spreadValues=(s,t)=>{for(var e in t||(t={}))__hasOwnProp.call(t,e)&&__defNormalProp(s,e,t[e]);if(__getOwnPropSymbols)for(var e of __getOwnPropSymbols(t))__propIsEnum.call(t,e)&&__defNormalProp(s,e,t[e]);return s},__spreadProps=(s,t)=>__defProps(s,__getOwnPropDescs(t));function nearestPointOnLine(s,t,e={}){if(!s||!t)throw new Error("lines and pt are required arguments");let i=point([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),r=0;return flattenEach(s,function(l,c,u){const h=getCoords(l);for(let d=0;d<h.length-1;d++){const g=point(h[d]);g.properties.dist=distance(t,g,e);const v=point(h[d+1]);v.properties.dist=distance(t,v,e);const E=distance(g,v,e),M=Math.max(g.properties.dist,v.properties.dist),w=bearing(g,v),I=destination(t,M,w+90,e),U=destination(t,M,w-90,e),A=lineIntersect(lineString([I.geometry.coordinates,U.geometry.coordinates]),lineString([g.geometry.coordinates,v.geometry.coordinates]));let W;A.features.length>0&&A.features[0]&&(W=__spreadProps(__spreadValues({},A.features[0]),{properties:{dist:distance(t,A.features[0],e),multiFeatureIndex:u,location:r+distance(g,A.features[0],e)}})),g.properties.dist<i.properties.dist&&(i=__spreadProps(__spreadValues({},g),{properties:__spreadProps(__spreadValues({},g.properties),{index:d,multiFeatureIndex:u,location:r})})),v.properties.dist<i.properties.dist&&(i=__spreadProps(__spreadValues({},v),{properties:__spreadProps(__spreadValues({},v.properties),{index:d+1,multiFeatureIndex:u,location:r+E})})),W&&W.properties.dist<i.properties.dist&&(i=__spreadProps(__spreadValues({},W),{properties:__spreadProps(__spreadValues({},W.properties),{index:d})})),r+=E}}),i}function trySnapPoint(s,t,e,i=5){const r=getClosestFeature(s,t);if(!r||r.dist*1e3>i*getMetersPerPixel(r.lngLat.lat,e))return null;if(r.feature instanceof Point)return{type:"point",point:r.feature};if(isLinearFeature$1(r.feature)){const l=checkSnapToSegmentVertex(r,t,.0025);if(l)return{type:"segment_vertex",feature:r.feature,path:l};if(r.path)return{type:"segment",feature:r.feature,path:r.path,lngLat:r.lngLat}}return null}function isLinearFeature$1(s){return s instanceof LinearFeature}function checkSnapToSegmentVertex(s,t,e){if(!s.segment||!s.path||!isLinearFeature$1(s.feature))return null;const[i,r]=s.segment,l=t.includes(i),c=t.includes(r);if(!l&&!c)return null;const u=[s.lngLat.lng,s.lngLat.lat],h=distance(i.lngLat.toArray(),u),d=distance(r.lngLat.toArray(),u);return l&&!c||l&&c&&h<d?h<e?s.path:null:(!l&&c||l&&c&&d<h)&&d<e?s.feature.incrementPath(s.path):null}const EARTH_CIRCUMFERENCE=40075017;function getMetersPerPixel(s,t){const e=s*(Math.PI/180);return EARTH_CIRCUMFERENCE*Math.cos(e)/2**(t+8)}function getClosestFeature(s,t){let e=null;for(const i of t)if(i instanceof Point){const r=distance(s.toArray(),i);(!e||r<e.dist)&&(e={lngLat:i.lngLat,dist:r,feature:i})}else if(i instanceof LineString){const r=nearestPointOnLine(i,s.toArray());if((!e||r.properties.dist<e.dist)&&r.properties.index<i.vertices.length-1){const l=r.properties.index.toString();e={lngLat:maplibreGlExports.LngLat.convert(r.geometry.coordinates),dist:r.properties.dist,feature:i,path:l,segment:i.getSegmentVertices(l)??void 0}}}else if(i instanceof Polygon){const r=polygonToLine(i);let l;r.geometry.type==="LineString"?l=[r.geometry.coordinates]:l=r.geometry.coordinates;for(let c=0;c<l.length;c++){const u=l[c],h=nearestPointOnLine(lineString(u),s.toArray());if(!e||h.properties.dist<e.dist){const d=`${c}.${h.properties.index}`;e={lngLat:maplibreGlExports.LngLat.convert(h.geometry.coordinates),dist:h.properties.dist,feature:i,path:d,segment:i.getSegmentVertices(d)??void 0}}}}return e}var Bt,lt;class DrawControl{constructor(t){p(this,Bt);p(this,lt,[]);f(this,Bt,createControlContainer("maplibregl-ctrl-draw")),n(this,lt).push(createControlButton({title:t.drawPointButtonTitle??"Draw Point",icon:createMdiIcon("map-marker-outline"),onClick:e=>{e.classList.add("active"),t.onDrawPoint()},shortcut:["1"]})),n(this,lt).push(createControlButton({title:t.drawLineButtonTitle??"Draw Line",icon:createMdiIcon("vector-line"),onClick:e=>{e.classList.add("active"),t.onDrawLine()},shortcut:["2"]})),n(this,lt).push(createControlButton({title:t.drawPolygonButtonTitle??"Draw Area",icon:createMdiIcon("vector-polygon"),onClick:e=>{e.classList.add("active"),t.onDrawPolygon()},shortcut:["3"]})),$$1("body").on("keydown",e=>{const i=+e.key-1;i>=0&&i<n(this,lt).length&&n(this,lt)[i].click()})}deactivateButton(t){var e;(e=n(this,lt)[t])==null||e.classList.remove("active")}setButtonDisabled(t,e){n(this,lt)[t]&&(n(this,lt)[t].disabled=e)}onAdd(t){return n(this,Bt).append(...n(this,lt)),n(this,Bt)}onRemove(){var t;(t=n(this,Bt).parentNode)==null||t.removeChild(n(this,Bt))}}Bt=new WeakMap,lt=new WeakMap;class Component{}var ct,Ze,te;class FeatureTypeButton extends Component{constructor(e){super();p(this,ct);p(this,Ze);p(this,te);f(this,ct,$$1('<button id="feature-type-btn" class="btn btn-secondary"></button>')),n(this,ct).on("click",e.onClick),f(this,Ze,$$1("<img>")),f(this,te,$$1("<span></span>")),n(this,ct).append(n(this,Ze),n(this,te))}get disabled(){return!!n(this,ct).prop("disabled")}set disabled(e){n(this,ct).prop("disabled",e)}setFeatureType(e){n(this,te).text((e==null?void 0:e.localizedName)??"")}setFeatureTypes(e){if(!e.length)this.setFeatureType(null);else{const i=e.map(r=>r.localizedName);n(this,te).text([...i].join(", "))}}get container(){return n(this,ct)}get visible(){return n(this,ct).is(":visible")}set visible(e){e?n(this,ct).show():n(this,ct).hide()}}ct=new WeakMap,Ze=new WeakMap,te=new WeakMap;var ve,ot,be,We,V,Ri,On,Mn,kn,Vi,Ai,Fn,$n,In,_n;class EditorPanel{constructor(t,e){p(this,V);p(this,ve);p(this,ot);p(this,be,new Set);p(this,We);f(this,We,e),f(this,ve,$$1("#editor-panel").show()),f(this,ot,new FeatureTypeButton({onClick:()=>{o(this,V,Fn).call(this)}})),n(this,ot).visible=!1,n(this,ve).append(n(this,ot).container),t.on(FeatureSelectionEvent.TYPE,i=>{n(this,be).clear(),i.features.forEach(r=>n(this,be).add(r)),o(this,V,Ri).call(this,i.features,!0)}),t.on(FeatureHoverEvent.TYPE,i=>{n(this,be).size||o(this,V,Ri).call(this,i.feature?[i.feature]:[],!1)})}getContainer(){return n(this,ve)}}ve=new WeakMap,ot=new WeakMap,be=new WeakMap,We=new WeakMap,V=new WeakSet,Ri=function(t,e){o(this,V,On).call(this),t.length===1?o(this,V,Mn).call(this,t[0],e):o(this,V,kn).call(this,t)},On=function(){n(this,ot).disabled=!0,o(this,V,Vi).call(this,null)},Mn=function(t,e){var r;const i=((r=t.dataObject)==null?void 0:r.type)??o(this,V,Ai).call(this,t);n(this,ot).disabled=!e,o(this,V,Vi).call(this,i),i.properties.forEach(l=>{var c,u;if(o(this,V,$n).call(this,l),l.isUnique){const h=(c=t.dataObject)==null?void 0:c.getPropertyValue(l.label);h!==null&&o(this,V,In).call(this,l,h)}else{const h=((u=t.dataObject)==null?void 0:u.getPropertyValues(l.label))??[];o(this,V,_n).call(this,l,h)}})},kn=function(t){const e=t.map(i=>{var r;return((r=i.dataObject)==null?void 0:r.type)??o(this,V,Ai).call(this,i)});n(this,ot).disabled=!0,n(this,ot).visible=!!t.length,n(this,ot).setFeatureTypes(e),t.length},Vi=function(t){n(this,ot).visible=!!t,n(this,ot).setFeatureType(t)},Ai=function(t){return n(this,We).call(this,t.geometry.type.toLowerCase(),"ObjectType")},Fn=function(){console.log("type button clicked")},$n=function(t){console.log("create field for",t.fullName)},In=function(t,e){console.log("set field value for",t.fullName,"to",e)},_n=function(t,e){console.log("set field values for",t.fullName,"to",e)};var ee,Mt,jt,j,k,Di,_;class ContextMenu{constructor(t,e){p(this,k);p(this,ee);p(this,Mt);p(this,jt);p(this,j);f(this,ee,t),f(this,jt,createControlContainer("map-editor-context-menu-container")),f(this,j,{move:createControlButton({title:e.moveTitle??"Move",icon:createMdiIcon("cursor-move"),onClick:()=>{o(this,k,_).call(this,e.onMove)},shortcut:["M"]}),copy:createControlButton({title:e.copyTitle??"Copy",icon:createMdiIcon("content-copy"),onClick:()=>{o(this,k,_).call(this,e.onCopy)},shortcut:["Ctrl","C"]}),paste:createControlButton({title:e.pasteTitle??"Paste",icon:createMdiIcon("content-paste"),onClick:()=>{o(this,k,_).call(this,e.onPaste)},shortcut:["Ctrl","V"]}),delete:createControlButton({title:e.deleteTitle??"Delete",icon:createMdiIcon("trash-can-outline"),onClick:()=>{o(this,k,_).call(this,e.onDelete)},shortcut:["Ctrl","Backspace"]}),continueLine:createControlButton({title:e.continueLineTitle??"Continue Line",icon:createMdiIcon("ray-start-arrow"),onClick:()=>{o(this,k,_).call(this,e.onContinueLine)},shortcut:["A"]}),disconnect:createControlButton({title:e.disconnectTitle??"Disconnect",icon:createMdiIcon("pan-horizontal"),onClick:()=>{o(this,k,_).call(this,e.onDisconnect)},shortcut:["D"]}),extractPoint:createControlButton({title:e.extractPointTitle??"Extract Point",icon:createMdiIcon("pan-top-right"),onClick:()=>{o(this,k,_).call(this,e.onExtractPoint)},shortcut:["E"]}),split:createControlButton({title:e.splitTitle??"Split",icon:createMdiIcon("content-cut"),onClick:()=>{o(this,k,_).call(this,e.onSplit)},shortcut:["X"]}),circularize:createControlButton({title:e.circularizeTitle??"Circularize",icon:createMdiIcon("vector-circle"),onClick:()=>{o(this,k,_).call(this,e.onCircularize)},shortcut:["O"]}),square:createControlButton({title:e.squareTitle??"Square",icon:createMdiIcon("vector-square"),onClick:()=>{o(this,k,_).call(this,e.onSquare)},shortcut:["Q"]}),flipLong:createControlButton({title:e.flipLongTitle??"Flip Long",icon:createMdiIcon("dock-top"),onClick:()=>{o(this,k,_).call(this,e.onFlipLong)},shortcut:["T"]}),flipShort:createControlButton({title:e.flipShortTitle??"Flip Short",icon:createMdiIcon("dock-left"),onClick:()=>{o(this,k,_).call(this,e.onFlipShort)},shortcut:["Y"]}),reverseLine:createControlButton({title:e.reverseLineTitle??"Reverse Line",icon:createMdiIcon("chevron-double-left"),onClick:()=>{o(this,k,_).call(this,e.onReverseLine)},shortcut:["V"]}),rotate:createControlButton({title:e.rotateTitle??"Rotate",icon:createMdiIcon("backup-restore"),onClick:()=>{o(this,k,_).call(this,e.onRotate)},shortcut:["R"]}),straightenLine:createControlButton({title:e.straightenLineTitle??"Straighten Line",icon:createMdiIcon("ray-start-vertex-end"),onClick:()=>{o(this,k,_).call(this,e.onStraightenLine)},shortcut:["S"]})}),$$1("body").on("keydown",i=>{if(!(n(this,ee)instanceof OttmMap&&n(this,ee).textFieldHasFocus))switch(i.key){case"v":i.ctrlKey?o(this,k,_).call(this,e.onPaste):o(this,k,_).call(this,e.onReverseLine);break;case"c":i.ctrlKey&&o(this,k,_).call(this,e.onCopy);break;case"m":o(this,k,_).call(this,e.onMove);break;case"Backspace":i.ctrlKey&&o(this,k,_).call(this,e.onDelete);break;case"a":o(this,k,_).call(this,e.onContinueLine);break;case"d":o(this,k,_).call(this,e.onDisconnect);break;case"e":o(this,k,_).call(this,e.onExtractPoint);break;case"x":o(this,k,_).call(this,e.onSplit);break;case"o":o(this,k,_).call(this,e.onCircularize);break;case"q":o(this,k,_).call(this,e.onSquare);break;case"t":o(this,k,_).call(this,e.onFlipLong);break;case"y":o(this,k,_).call(this,e.onFlipShort);break;case"r":o(this,k,_).call(this,e.onRotate);break;case"s":o(this,k,_).call(this,e.onStraightenLine);break}}),n(this,jt).append(n(this,j).move,n(this,j).continueLine,n(this,j).disconnect,n(this,j).split,n(this,j).circularize,n(this,j).square,n(this,j).flipLong,n(this,j).flipShort,n(this,j).reverseLine,n(this,j).rotate,n(this,j).straightenLine,n(this,j).copy,n(this,j).paste,n(this,j).delete),f(this,Mt,new maplibreGlExports.Popup().setDOMContent(n(this,jt))),n(this,Mt)._closeButton.style.display="none"}show(t,e={}){n(this,jt).style.display="block";let i=!1;for(const[r,l]of Object.entries(n(this,j))){const c=e[r];o(this,k,Di).call(this,l,!!c),c&&(i=!0)}i&&(n(this,Mt).setLngLat(t).addTo(n(this,ee)),n(this,Mt).addClassName("map-editor-context-menu"))}hide(){n(this,Mt).remove(),n(this,jt).style.display="none";for(const t of Object.values(n(this,j)))o(this,k,Di).call(this,t,!1)}isVisible(){return n(this,Mt).isOpen()}}ee=new WeakMap,Mt=new WeakMap,jt=new WeakMap,j=new WeakMap,k=new WeakSet,Di=function(t,e){t.style.display=e?"block":"none",t.disabled=!e},_=function(t){t(),this.hide()};var Cursor=(s=>(s.POINT="point",s.LINE="linestring",s.POLYGON="polygon",s.DRAW="draw",s.GRAB="grab",s.GRABBING="grabbing",s.CONNECT_VERTEX="draw-connect-vertex",s.CONNECT_LINE="draw-connect-line",s))(Cursor||{}),Si,Ei,Pi,Ci,Li,kt,P,ie,Ke,ne,Ut,Ft,ht,Se,T,F,L,R,D,ut,q,Ht,et,re,Ye,$t,xi,a,le,Te,Ct,dt,zn,Nn,Rn,Gi,ce,Vn,ai,Bi,Oe,An,li,ji,Dn,Ui,he,_t,Me,St,Ee,Gn,Bn,H,Hi,jn,qi,Zi,Un,Wi,Ki,Hn,qn,Zn,Yi,Qi,Xi,Ji,Wn,Kn,Yn,Qn,tn,en,zt,ci,ke,Xn,ue,Wt,Fe,nn,Jn,tr,er,ir,nr,rn,sn,on,rr,sr,or,ar,lr,cr,hr,ur,dr,pr,gr,fr,mr,yr,an,wr,vr,br,Sr,Er,N;const z=class z{constructor(t,e){p(this,a);p(this,P);p(this,ie);p(this,Ke);p(this,ne);p(this,Ut);p(this,Ft);p(this,ht,new Map);p(this,Se,new Map);p(this,T,new Set);p(this,F,null);p(this,L,"select");p(this,R,null);p(this,D,null);p(this,ut,[]);p(this,q,null);p(this,Ht,!0);p(this,et,null);p(this,re,[]);p(this,Ye,null);p(this,$t,{units:{},enums:{},objects:{}});p(this,xi,0);n(this,$t).units={...e.units},n(this,$t).enums={...e.enums},n(this,$t).objects={...e.objects},f(this,P,t),f(this,ie,$$1(n(this,P).getCanvasContainer())),f(this,Ke,new EditorPanel(n(this,P),(c,u)=>o(this,a,le).call(this,c,u))),f(this,ne,new ContextMenu(n(this,P),{onMove:()=>{o(this,a,Jn).call(this)},moveTitle:window.ottm.translate("map.context_menu.move.tooltip"),onCopy:()=>{o(this,a,er).call(this)},copyTitle:window.ottm.translate("map.context_menu.copy.tooltip"),onPaste:()=>{o(this,a,nr).call(this)},pasteTitle:window.ottm.translate("map.context_menu.paste.tooltip"),onDelete:()=>{o(this,a,sn).call(this)},deleteTitle:window.ottm.translate("map.context_menu.delete.tooltip"),onContinueLine:()=>{o(this,a,rr).call(this)},continueLineTitle:window.ottm.translate("map.context_menu.continue_line.tooltip"),onDisconnect:()=>{o(this,a,or).call(this)},disconnectTitle:window.ottm.translate("map.context_menu.disconnect.tooltip"),onExtractPoint:()=>{o(this,a,lr).call(this)},extractPointTitle:window.ottm.translate("map.context_menu.extract_point.tooltip"),onSplit:()=>{o(this,a,hr).call(this)},splitTitle:window.ottm.translate("map.context_menu.split.tooltip"),onCircularize:()=>{o(this,a,dr).call(this)},circularizeTitle:window.ottm.translate("map.context_menu.circularize.tooltip"),onSquare:()=>{o(this,a,gr).call(this)},squareTitle:window.ottm.translate("map.context_menu.square.tooltip"),onFlipLong:()=>{o(this,a,mr).call(this)},flipLongTitle:window.ottm.translate("map.context_menu.flip_long.tooltip"),onFlipShort:()=>{o(this,a,yr).call(this)},flipShortTitle:window.ottm.translate("map.context_menu.flip_short.tooltip"),onReverseLine:()=>{o(this,a,wr).call(this)},reverseLineTitle:window.ottm.translate("map.context_menu.reverse_line.tooltip"),onRotate:()=>{o(this,a,br).call(this)},rotateTitle:window.ottm.translate("map.context_menu.rotate.tooltip"),onStraightenLine:()=>{o(this,a,Er).call(this)},straightenLineTitle:window.ottm.translate("map.context_menu.straighten_line.tooltip")})),f(this,Ft,new DrawControl({onDrawPoint:()=>{n(this,L)==="draw_point"?o(this,a,ai).call(this):o(this,a,Vn).call(this)},onDrawLine:()=>{n(this,L)==="draw_line"?o(this,a,Oe).call(this):o(this,a,Bi).call(this)},onDrawPolygon:()=>{n(this,L)==="draw_polygon"?o(this,a,li).call(this):o(this,a,An).call(this)},drawPointButtonTitle:window.ottm.translate("map.controls.edit.draw_point.tooltip"),drawLineButtonTitle:window.ottm.translate("map.controls.edit.draw_line.tooltip"),drawPolygonButtonTitle:window.ottm.translate("map.controls.edit.draw_polygon.tooltip")})),n(this,P).addControl(n(this,Ft),"top-left"),n(this,P).dragRotate.disable(),n(this,P).on("click",c=>{o(this,a,Hn).call(this,c)}),n(this,P).on("dblclick",c=>{o(this,a,Kn).call(this,c)}),n(this,P).on("mousemove",c=>{o(this,a,Hi).call(this,c)}),n(this,P).on("touchmove",c=>{c.points.length===1&&o(this,a,Hi).call(this,c)}),n(this,P).on("mousedown",c=>{o(this,a,Wi).call(this,c)}),n(this,P).on("touchstart",c=>{c.points.length===1&&o(this,a,Wi).call(this,c)}),n(this,P).on("mouseup",c=>{o(this,a,Ki).call(this,c)}),n(this,P).on("touchend",c=>{c.points.length===1&&o(this,a,Ki).call(this,c)}),n(this,P).on("controls.styles.tiles_changed",()=>{n(this,P).getLayersOrder().length&&n(this,P).moveLayer("tiles",n(this,P).getLayersOrder()[0])}),n(this,P).on("zoomstart",()=>{o(this,a,Qn).call(this)}),n(this,P).on("zoomend",()=>{o(this,a,tn).call(this)}),n(this,P).on("load",()=>{o(this,a,tn).call(this)}),$$1("body").on("keydown",c=>{c.originalEvent&&(!(n(this,P)instanceof OttmMap)||!n(this,P).textFieldHasFocus)&&o(this,a,Yn).call(this,c.originalEvent)});const i=n(this,ie).parent();i.addClass("split");const r=n(this,Ke).getContainer();r.addClass("split"),Split([r[0],i[0]],{sizes:[20,80],minSize:[0,100],gutterSize:5});const l=window.ottm.translate("map.edit_zoom_notice");f(this,Ut,$$1(`
<div id="edit-zoom-notice-panel">
  <span class="mdi mdi-plus"></span> ${l}
</div>
`)),n(this,Ut).on("click",()=>n(this,P).easeTo({zoom:n(z,kt)})),i.append(n(this,Ut))}createFeature(t){const e=l=>l.map(c=>{const u=n(this,Se).get(c);if(!u)throw new Error(`No point with ID ${c}`);return u}),i=(l,c)=>o(this,a,le).call(this,l,c),r=o(this,a,Te).call(this);if(t.type==="Point"){const l=new maplibreGlExports.LngLat(t.lng,t.lat);o(this,a,Ct).call(this,new Point(r,i,l,t.dbId,t.layer,t.dataObject))}else if(t.type==="LineString"){const l=e(t.verticesDbIds);o(this,a,Ct).call(this,new LineString(r,i,l,t.dbId,t.layer,t.dataObject))}else{const l=t.verticesDbIds.map(c=>e(c));o(this,a,Ct).call(this,new Polygon(r,i,l,t.dbId,t.layer,t.dataObject))}}};Si=new WeakMap,Ei=new WeakMap,Pi=new WeakMap,Ci=new WeakMap,Li=new WeakMap,kt=new WeakMap,P=new WeakMap,ie=new WeakMap,Ke=new WeakMap,ne=new WeakMap,Ut=new WeakMap,Ft=new WeakMap,ht=new WeakMap,Se=new WeakMap,T=new WeakMap,F=new WeakMap,L=new WeakMap,R=new WeakMap,D=new WeakMap,ut=new WeakMap,q=new WeakMap,Ht=new WeakMap,et=new WeakMap,re=new WeakMap,Ye=new WeakMap,$t=new WeakMap,xi=new WeakMap,a=new WeakSet,le=function(t,e){switch(e){case"UnitType":return n(this,$t).units[t];case"Enum":return n(this,$t).enums[t];case"ObjectType":return n(this,$t).objects[t];default:throw new Error(`Invalid value "${e}"`)}},Te=function(){return(ri(this,xi)._++).toString()},Ct=function(t){t.id&&n(this,ht).get(t.id)||(n(this,ht).set(t.id,t),t instanceof Point?t.dbId&&n(this,Se).set(t.dbId,t):t instanceof LineString?t.vertices.forEach(e=>{o(this,a,Ct).call(this,e)}):t instanceof Polygon&&t.vertices.flatMap(e=>e).forEach(e=>{o(this,a,Ct).call(this,e)}),n(this,P).addSource(t.id,{type:"geojson",data:t}),o(this,a,Gn).call(this,t),t instanceof LineString?t.vertices.forEach(e=>{o(this,a,_t).call(this,e.id),o(this,a,N).call(this,e)}):t instanceof Polygon&&t.vertices.flatMap(e=>e).forEach(e=>{o(this,a,_t).call(this,e.id),o(this,a,N).call(this,e)}))},dt=function(t){var i,r;const e=n(this,ht).get(t);e&&((i=o(this,a,Me).call(this,t))==null||i.forEach(l=>n(this,P).removeLayer(l)),n(this,ht).delete(t),e instanceof Point?(e.dbId&&n(this,Se).delete(e.dbId),o(this,a,zn).call(this,e)):e instanceof LineString?o(this,a,Nn).call(this,e):e instanceof Polygon&&o(this,a,Rn).call(this,e),n(this,P).removeSource(t),n(this,T).delete(e),((r=n(this,F))==null?void 0:r.id)===t&&f(this,F,null))},zn=function(t){t.boundFeatures.forEach(e=>{t.unbindFeature(e);const i=e.removeVertex(t);let r=!1;i.type==="delete_feature"?(o(this,a,dt).call(this,e.id),r=!0):i.type==="delete_ring"&&(e.deleteRing(i.ringIndex),i.points.forEach(l=>{l.boundFeatures.length===0&&o(this,a,dt).call(this,l.id)})),r||o(this,a,N).call(this,e)})},Nn=function(t){o(this,a,Gi).call(this,t,t.vertices)},Rn=function(t){t.vertices.forEach(e=>{o(this,a,Gi).call(this,t,e)})},Gi=function(t,e){e.forEach(i=>{i.unbindFeature(t),i.boundFeatures.length===0?o(this,a,dt).call(this,i.id):o(this,a,N).call(this,i)})},ce=function(t){switch(n(this,L)){case"view_only":case"select":o(this,a,Wt).call(this,t);break;case"draw_point":o(this,a,ai).call(this,t);break;case"draw_line":o(this,a,Oe).call(this,t);break;case"draw_polygon":o(this,a,li).call(this,t);break;case"move_features":o(this,a,Dn).call(this);break}},Vn=function(){n(this,L)!=="view_only"&&(o(this,a,ce).call(this),f(this,L,"draw_point"),o(this,a,H).call(this,"draw"))},ai=function(t){f(this,L,"select"),o(this,a,Wt).call(this,t),n(this,Ft).deactivateButton(0)},Bi=function(t,e){n(this,L)!=="view_only"&&(o(this,a,ce).call(this),f(this,L,"draw_line"),t&&e&&t.isEndVertex(e)?(f(this,q,t),f(this,R,o(this,a,Fe).call(this,e.lngLat)),f(this,Ht,t.vertices.indexOf(e)!==0),n(this,Ht)?n(this,q).appendVertex(n(this,R),n(this,q).getNextVertexPath()):n(this,q).appendVertex(n(this,R),"0"),o(this,a,N).call(this,n(this,q))):(f(this,q,new LineString(o(this,a,Te).call(this),(i,r)=>o(this,a,le).call(this,i,r))),o(this,a,Ct).call(this,n(this,q))),o(this,a,H).call(this,"draw"))},Oe=function(t){n(this,q)&&(o(this,a,ji).call(this,n(this,q),1,t),f(this,q,null))},An=function(){n(this,L)!=="view_only"&&(o(this,a,ce).call(this),f(this,L,"draw_polygon"),f(this,et,new Polygon(o(this,a,Te).call(this),(t,e)=>o(this,a,le).call(this,t,e))),o(this,a,Ct).call(this,n(this,et)),o(this,a,H).call(this,"draw"))},li=function(t){n(this,et)&&(o(this,a,ji).call(this,n(this,et),2,t,()=>{var e;return(e=n(this,et))==null?void 0:e.lockRing(0)}),f(this,et,null))},ji=function(t,e,i,r){f(this,L,"select");let l=null;n(this,R)&&(l=t.removeVertex(n(this,R)),o(this,a,dt).call(this,n(this,R).id),f(this,R,null)),(l==null?void 0:l.type)==="delete_feature"?(o(this,a,dt).call(this,t.id),n(this,re).forEach(c=>{o(this,a,dt).call(this,c.id)})):t.isEmpty()?o(this,a,dt).call(this,t.id):(r==null||r(),o(this,a,N).call(this,t),o(this,a,ke).call(this,t,!1)),n(this,re).splice(0),o(this,a,Wt).call(this,i),n(this,Ft).deactivateButton(e)},Dn=function(){f(this,L,"select");const t=new Set;n(this,ut).forEach(({point:e,startPos:i})=>{e.lngLat=i,o(this,a,N).call(this,e),e.boundFeatures.forEach(r=>t.add(r))}),t.forEach(e=>{o(this,a,N).call(this,e)}),n(this,ut).splice(0)},Ui=function(t){const e=n(this,P).getLayersOrder();let i=1/0,r=null;for(const l of o(this,a,he).call(this,t)){const c=e.indexOf(l);if(c===-1)continue;const u=n(this,ht).get(l),h=u instanceof Point,d=!(r instanceof Point);(!r||h&&(d||c>i)||!h&&d&&c<i)&&(i=c,r=u??null)}return r},he=function(t,e){const i=n(this,P).queryRenderedFeatures(t).filter(r=>!(e!=null&&e.has(r.source))).map(r=>r.source);return[...new Set(i)]},_t=function(t,e){var i,r,l;if(e){const c=(i=o(this,a,Me).call(this,e))==null?void 0:i[0];(r=o(this,a,Me).call(this,t))==null||r.forEach(u=>n(this,P).moveLayer(u,c))}else(l=o(this,a,Me).call(this,t))==null||l.forEach(c=>n(this,P).moveLayer(c))},Me=function(t){const e=n(this,ht).get(t);return e instanceof Point?[e.id+"-highlight",e.id]:e instanceof LineString?[e.id+"-highlight",e.id,e.id+"-foreground"]:e instanceof Polygon?[e.id,e.id+"-highlight",e.id+"-border"]:null},St=new WeakMap,Ee=new WeakMap,Gn=function(t){if(t instanceof Point)n(this,P).addLayer({id:t.id+"-highlight",type:"circle",source:t.id,paint:{"circle-radius":["+",["get","radius"],4],"circle-color":n(z,Ee)},filter:n(z,St)}),n(this,P).addLayer({id:t.id,type:"circle",source:t.id,paint:{"circle-radius":["get","radius"],"circle-color":["get","color"],"circle-stroke-width":1,"circle-stroke-color":n(z,Ci)},filter:n(z,St)});else if(t instanceof LineString)n(this,P).addLayer({id:t.id+"-highlight",type:"line",source:t.id,layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["+",["get","width"],8],"line-color":n(z,Ee)},filter:n(z,St)}),n(this,P).addLayer({id:t.id,type:"line",source:t.id,layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":["get","width"],"line-color":["step",["zoom"],n(z,Li),n(z,kt),["get","color"]]}}),n(this,P).addLayer({id:t.id+"-foreground",type:"line",source:t.id,layout:{"line-cap":"butt","line-join":"round"},paint:{"line-width":["get","fgWidth"],"line-color":["get","fgColor"]},filter:n(z,St)});else if(t instanceof Polygon)n(this,P).addLayer({id:t.id,type:"fill",source:t.id,paint:{"fill-color":["concat",["get","color"],"30"]},filter:n(z,St)}),n(this,P).addLayer({id:t.id+"-highlight",type:"line",source:t.id,layout:{"line-cap":"round","line-join":"round"},paint:{"line-width":8,"line-color":n(z,Ee)},filter:n(z,St)}),n(this,P).addLayer({id:t.id+"-border",type:"line",source:t.id,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","color"]},filter:n(z,St)});else throw TypeError(`Unexpected type: ${t}`);o(this,a,Bn).call(this,t)},Bn=function(t){t instanceof LineString&&(n(this,P).setPaintProperty(t.id,"line-dasharray",t.properties.dash),n(this,P).setPaintProperty(t.id+"-foreground","line-dasharray",t.properties.fgDash))},H=function(t){n(this,ie).addClass(`cursor-${t}`);for(const e of Object.values(Cursor))e!==t&&n(this,ie).removeClass(`cursor-${e}`)},Hi=function(t){if(f(this,Ye,t.lngLat),n(this,L)==="view_only")return;if(n(this,L)==="move_features"){o(this,a,Un).call(this,t);return}const e=o(this,a,Ui).call(this,t.point);e?n(this,R)||o(this,a,zt).call(this,e):o(this,a,ci).call(this),n(this,R)?o(this,a,jn).call(this,t):o(this,a,Wt).call(this)},jn=function(t){const e=n(this,R);if(!e)return;o(this,a,ue).call(this),o(this,a,H).call(this,"draw");const i=new Set;e.boundFeatures.forEach(c=>{if(i.add(c.id),c instanceof LineString){const u=(c.vertices.length-1).toString();!c.isLoop()&&c.getVertexPath(e)==="0"?c.vertices.filter(h=>c.getVertexPath(h)!==u).forEach(h=>i.add(h.id)):!c.isLoop()&&c.getVertexPath(e)===u?c.vertices.slice(1).forEach(h=>i.add(h.id)):c.vertices.forEach(h=>i.add(h.id))}else c instanceof Polygon&&c.vertices.flatMap(u=>u).forEach(u=>i.add(u.id))}),i.add(e.id);const r=o(this,a,he).call(this,void 0,i).map(c=>{const u=n(this,ht).get(c);if(!u)throw new Error(`Missing feature with ID ${c}`);return u}),l=trySnapPoint(t.lngLat,r,n(this,P).getZoom());if(f(this,D,null),l)if(l.type==="point"||l.type==="segment_vertex"){let c;if(l.type==="point")c=l.point;else{const{feature:h,path:d}=l,g=h.getVertex(d);if(!g)throw new Error(`Invalid path "${d}"`);c=g}c.boundFeatures.every(h=>{const d=h.getVertexPath(c);if(!d)throw new Error(`Point #${c.id} does not belong to feature #${h.id}`);return h.canAcceptVertex(e,d)})&&(f(this,D,l),e.onDrag(c.lngLat),o(this,a,zt).call(this,c),o(this,a,H).call(this,"draw-connect-vertex"))}else{const{feature:c,path:u,lngLat:h}=l;let d=c.canInsertVertex(e,u),g,v;if(d){const E=c.getSegmentVertices(u);if(!E)throw new Error(`Invalid path "${u}"`);[g,v]=E;for(const M of i){const w=n(this,ht).get(M);if(isLinearFeature(w)&&w.getSegmentPath(g,v)){d=!1;break}}}if(d){const E=[];r.forEach(M=>{if(isLinearFeature(M)&&M!==c){const w=M.getSegmentPath(g,v);w&&E.push({feature:M,path:w})}}),f(this,D,l),E.length&&(n(this,D).featuresWithSameSegment=E),e.onDrag(h),o(this,a,zt).call(this,c),o(this,a,H).call(this,"draw-connect-line")}}n(this,D)||(o(this,a,ci).call(this),e.onDrag(t.lngLat),(n(this,L)==="draw_line"&&o(this,a,qi).call(this,t.point)[0]||n(this,L)==="draw_polygon"&&o(this,a,Zi).call(this,t.point)[0])&&o(this,a,H).call(this,"draw-connect-vertex")),o(this,a,N).call(this,e),e.boundFeatures.forEach(c=>{o(this,a,N).call(this,c)})},qi=function(t){if(!n(this,q))return[!1,null];const e=n(this,q).vertices.length;if(e<=2)return[!1,null];const i=o(this,a,he).call(this,t),r=n(this,Ht)?n(this,q).getVertex((e-2).toString()):n(this,q).getVertex("1");return r?[i.some(l=>l===r.id),r]:[!1,null]},Zi=function(t){if(!n(this,et))return[!1,null];const e=n(this,et).vertices;if(e.length===0)return[!1,null];const i=e[0];if(i.length<3)return[!1,null];const r=o(this,a,he).call(this,t),l=n(this,et).getVertex(`0.${i.length-2}`);return l?[r.some(c=>c===l.id),l]:[!1,null]},Un=function(t){o(this,a,H).call(this,"grabbing");const e=new Set;n(this,ut).forEach(({point:i,offset:r})=>{i.onDrag(t.lngLat,r),o(this,a,N).call(this,i),i.boundFeatures.forEach(l=>e.add(l))}),e.forEach(i=>{o(this,a,N).call(this,i)})},Wi=function(t){if(n(this,L)==="select"){if(t.type==="mousedown"&&isSecondaryClick(t.originalEvent)){o(this,a,qn).call(this,t);return}n(this,F)instanceof Point?(t.preventDefault(),f(this,R,n(this,F)),o(this,a,_t).call(this,n(this,R).id)):o(this,a,H).call(this,"grabbing")}n(this,ne).isVisible()&&n(this,ne).hide()},Ki=function(t){if(n(this,L)!=="select")return;const e=n(this,R),i=n(this,D);if(i&&e){if(i.type==="point"||i.type==="segment_vertex"){const r=o(this,a,Xi).call(this);if(!r)return;e.onDrag(r.lngLat),r.dataObject&&!e.dataObject&&e.copyDataOf(r),r.boundFeatures.forEach(l=>{l.replaceVertex(e,r)}),o(this,a,dt).call(this,r.id)}else o(this,a,Ji).call(this);e.boundFeatures.forEach(r=>{o(this,a,N).call(this,r)}),o(this,a,N).call(this,e),o(this,a,_t).call(this,e.id),f(this,D,null)}e&&(o(this,a,zt).call(this,e),f(this,R,null)),o(this,a,Wt).call(this,t.point)},Hn=function(t){switch(n(this,L)){case"draw_point":o(this,a,Zn).call(this,t);break;case"draw_line":n(this,q)&&o(this,a,Yi).call(this,n(this,q),t);break;case"draw_polygon":n(this,et)&&o(this,a,Yi).call(this,n(this,et),t);break;case"move_features":o(this,a,Wn).call(this,t);break;case"select":if(n(this,F)){const e=t.originalEvent.ctrlKey;e&&n(this,T).has(n(this,F))?o(this,a,Xn).call(this,n(this,F)):o(this,a,ke).call(this,n(this,F),e)}else o(this,a,ue).call(this);break;case"view_only":o(this,a,ue).call(this);break}},qn=function(t){const e={};if(n(this,F)){n(this,F).selectionMode!==SelectionMode.SELECTED&&o(this,a,ke).call(this,n(this,F),!1),e.move=o(this,a,nn).call(this).length!==0,e.copy=o(this,a,tr).call(this).length!==0,e.delete=o(this,a,rn).call(this).length!==0,e.continueLine=o(this,a,on).call(this)!==null,e.disconnect=o(this,a,sr).call(this).length!==0,e.extractPoint=o(this,a,ar).call(this).length!==0,e.split=o(this,a,cr).call(this).length!==0,e.circularize=o(this,a,ur).call(this).length!==0,e.square=o(this,a,pr).call(this).length!==0;const i=o(this,a,fr).call(this).length!==0;e.flipLong=i,e.flipShort=i,e.reverseLine=o(this,a,an).call(this).length!==0,e.rotate=o(this,a,vr).call(this).length!==0,e.straightenLine=o(this,a,Sr).call(this).length!==0}else e.paste=o(this,a,ir).call(this).length!==0,o(this,a,ue).call(this);n(this,ne).show(t.lngLat,e)},Zn=function(t){o(this,a,ke).call(this,o(this,a,Qi).call(this,t),!1),o(this,a,ai).call(this,t.point),o(this,a,H).call(this,"point")},Yi=function(t,e){if(n(this,D)&&n(this,R)){if(n(this,D).type==="point"||n(this,D).type==="segment_vertex"){const l=o(this,a,Xi).call(this);if(!l)return;const c=t instanceof LineString&&t.isEndVertex(l);if(t.replaceVertex(l,n(this,R)),o(this,a,dt).call(this,n(this,R).id),o(this,a,_t).call(this,l.id),f(this,R,null),c){o(this,a,N).call(this,l),o(this,a,zt).call(this,l),o(this,a,H).call(this,"point"),o(this,a,Oe).call(this,e.point),f(this,D,null);return}}else o(this,a,Ji).call(this),n(this,re).push(n(this,R));f(this,D,null)}else{const[l,c]=t instanceof LineString?o(this,a,qi).call(this,e.point):o(this,a,Zi).call(this,e.point);if(l&&c){o(this,a,zt).call(this,c),o(this,a,H).call(this,"point"),t instanceof LineString?o(this,a,Oe).call(this,e.point):o(this,a,li).call(this,e.point);return}if(!n(this,R)){const u=o(this,a,Qi).call(this,e);u!==n(this,F)&&n(this,re).push(u),t instanceof LineString&&!n(this,Ht)?t.appendVertex(u,"0"):t.appendVertex(u,t.getNextVertexPath()),o(this,a,N).call(this,u)}}const i=n(this,R),r=o(this,a,Fe).call(this,e.lngLat);t instanceof LineString&&!n(this,Ht)?t.appendVertex(r,"0"):t.appendVertex(r,t.getNextVertexPath()),f(this,R,r),i&&o(this,a,N).call(this,i),o(this,a,N).call(this,t),(t instanceof LineString&&t.vertices.length>2||t instanceof Polygon&&t.vertices[0].length>3)&&o(this,a,H).call(this,"draw-connect-vertex")},Qi=function(t){let e;return n(this,F)instanceof Point?e=n(this,F):(e=o(this,a,en).call(this,t))||(e=o(this,a,Fe).call(this,t.lngLat)),o(this,a,_t).call(this,e.id),e},Xi=function(){var t,e;if(((t=n(this,D))==null?void 0:t.type)==="point")return n(this,D).point;if(((e=n(this,D))==null?void 0:e.type)==="segment_vertex"){const{feature:i,path:r}=n(this,D);return i.getVertex(r)}return null},Ji=function(){var e,i;const t=n(this,R);if(((e=n(this,D))==null?void 0:e.type)==="segment"&&t){const{feature:r,path:l,lngLat:c}=n(this,D);t.onDrag(c),r.insertVertexAfter(t,l),(i=n(this,D).featuresWithSameSegment)==null||i.forEach(({feature:u,path:h})=>{u.insertVertexAfter(t,h)}),o(this,a,_t).call(this,t.id)}},Wn=function(t){f(this,L,"select"),n(this,ut).splice(0),o(this,a,Wt).call(this,t.point)},Kn=function(t){if(isLinearFeature(n(this,F))){const e=o(this,a,en).call(this,t);e&&(o(this,a,zt).call(this,e),o(this,a,H).call(this,"point"))}},Yn=function(t){n(this,L)==="select"?t.key==="Delete"&&o(this,a,sn).call(this):t.key==="Escape"&&o(this,a,ce).call(this)},Qn=function(){n(this,R)?n(this,P).setMinZoom(n(z,kt)):n(this,P).setMinZoom(0)},tn=function(){const t=n(this,P).getZoom();if(t<n(z,kt)&&n(this,L)!=="view_only"){o(this,a,ce).call(this),f(this,L,"view_only"),o(this,a,ci).call(this),o(this,a,H).call(this,"grab");for(let e=0;e<3;e++)n(this,Ft).setButtonDisabled(e,!0);n(this,Ut).show()}else if(t>=n(z,kt)&&n(this,L)==="view_only"){f(this,L,"select");for(let e=0;e<3;e++)n(this,Ft).setButtonDisabled(e,!1);n(this,Ut).hide()}},en=function(t){if(isLinearFeature(n(this,F))){const e=o(this,a,he).call(this,t.point).map(r=>n(this,ht).get(r)).filter(r=>isLinearFeature(r)),i=trySnapPoint(t.lngLat,e,n(this,P).getZoom());if((i==null?void 0:i.type)==="segment"){const{feature:r,path:l,lngLat:c}=i,u=o(this,a,Fe).call(this,c),h=r.getSegmentVertices(l);if(!h)throw new Error(`Invalid path ${l}`);const[d,g]=h,v=(E,M)=>{E.insertVertexAfter(u,M),o(this,a,N).call(this,E)};return v(r,l),e.forEach(E=>{if(isLinearFeature(E)&&E!==r){const M=E.getSegmentPath(d,g);M&&v(E,M)}}),o(this,a,N).call(this,u),u}}return null},zt=function(t){n(this,F)!==t&&(n(this,F)&&!n(this,T).has(n(this,F))&&(n(this,F).selectionMode=SelectionMode.NONE,o(this,a,N).call(this,n(this,F))),f(this,F,t),n(this,T).has(n(this,F))||(n(this,F).selectionMode=SelectionMode.HOVERED,o(this,a,N).call(this,n(this,F))),n(this,P).fire(new FeatureHoverEvent(n(this,F))))},ci=function(){n(this,F)&&(n(this,T).has(n(this,F))||(n(this,F).selectionMode=SelectionMode.NONE,o(this,a,N).call(this,n(this,F))),f(this,F,null),n(this,P).fire(new FeatureHoverEvent))},ke=function(t,e){let i=!1;n(this,T).size&&!e&&(o(this,a,ue).call(this,!1),i=!0),n(this,T).has(t)||(n(this,T).add(t),t.selectionMode=SelectionMode.SELECTED,o(this,a,N).call(this,t),i=!0),i&&n(this,P).fire(new FeatureSelectionEvent([...n(this,T)]))},Xn=function(t){n(this,T).delete(t)&&(t.selectionMode=SelectionMode.NONE,o(this,a,N).call(this,t),n(this,P).fire(new FeatureSelectionEvent([...n(this,T)])))},ue=function(t=!0){n(this,T).size&&(n(this,T).forEach(e=>{e.selectionMode=SelectionMode.NONE,o(this,a,N).call(this,e)}),n(this,T).clear(),t&&n(this,P).fire(new FeatureSelectionEvent))},Wt=function(t){if(n(this,L)==="select"){const e=t?o(this,a,Ui).call(this,t):n(this,F);if(e){const i={Point:"point",LineString:"linestring",Polygon:"polygon"}[e.geometry.type];o(this,a,H).call(this,i)}else o(this,a,H).call(this,"grab")}},Fe=function(t){const e=new Point(o(this,a,Te).call(this),(i,r)=>o(this,a,le).call(this,i,r),t);return o(this,a,Ct).call(this,e),e},nn=function(){return n(this,L)!=="select"?[]:[...n(this,T)].filter(t=>!(t instanceof Point)||!t.boundFeatures.some(e=>n(this,T).has(e)))},Jn=function(){const t=n(this,Ye);if(!t)return;n(this,ut).splice(0);const e=new Set;o(this,a,nn).call(this).forEach(i=>{i instanceof Point?(e.add(i),n(this,ut).push({point:i,offset:LngLatVector.sub(i.lngLat,t),startPos:i.lngLat})):i instanceof LineString?i.vertices.forEach(r=>{e.has(r)||(e.add(r),n(this,ut).push({point:r,offset:LngLatVector.sub(r.lngLat,t),startPos:r.lngLat}))}):i instanceof Polygon&&i.vertices.flatMap(r=>r).forEach(r=>{e.has(r)||(e.add(r),n(this,ut).push({point:r,offset:LngLatVector.sub(r.lngLat,t),startPos:r.lngLat}))})}),n(this,ut).length&&(f(this,L,"move_features"),o(this,a,H).call(this,"grabbing"))},tr=function(){return n(this,L)==="select"?[...n(this,T)]:[]},er=function(){console.log("Not implemented yet.")},ir=function(){return[]},nr=function(){console.log("Not implemented yet.")},rn=function(){return n(this,L)==="select"?[...n(this,T)]:[]},sn=function(){o(this,a,rn).call(this).forEach(t=>{o(this,a,dt).call(this,t.id)}),n(this,T).clear()},on=function(){if(n(this,L)!=="select"||n(this,T).size!==1)return null;const t=n(this,T).values().next().value;if(!(t instanceof Point))return null;let e=null;for(const i of t.boundFeatures)if(i instanceof LineString&&i.isEndVertex(t)){if(e)return null;e=i}return e?[t,e]:null},rr=function(){const t=o(this,a,on).call(this);if(t){const[e,i]=t;o(this,a,Bi).call(this,i,e)}},sr=function(){return n(this,L)!=="select"?[]:[...n(this,T)].filter(t=>t instanceof Point&&t.boundFeatures.length>=2)},or=function(){console.log("Not implemented yet.")},ar=function(){return n(this,L)!=="select"?[]:[...n(this,T)].filter(t=>t instanceof Point&&!!t.dataObject&&t.boundFeatures.length!==0)},lr=function(){console.log("Not implemented yet.")},cr=function(){if(n(this,L)!=="select")return[];const t={},e=[];for(const i of n(this,T))i instanceof Point&&i.boundFeatures.length!==0&&i.boundFeatures.forEach(r=>{if(r instanceof LineString&&!r.isEndVertex(i)){const l=r.vertices.indexOf(i);t[r.id]?e[t[r.id]][1].push(l):(t[r.id]=e.length,e.push([r,[l]]))}});return e},hr=function(){console.log("Not implemented yet.")},ur=function(){return n(this,L)!=="select"?[]:[...n(this,T)].filter(t=>isLinearFeature(t)&&t.isNearlyCircular(0))},dr=function(){console.log("Not implemented yet.")},pr=function(){return n(this,L)!=="select"?[]:[...n(this,T)].filter(t=>isLinearFeature(t)&&t.isNearlySquare(0))},gr=function(){console.log("Not implemented yet.")},fr=function(){if(n(this,L)!=="select")return[];const t=n(this,T).values();if(n(this,T).size===1){const{value:e}=t.next();if(e instanceof Point||e instanceof LineString&&e.vertices.length===2)return[]}else if(n(this,T).size===2){const{value:e}=t.next(),{value:i}=t.next();if(e instanceof Point&&i instanceof Point)return[]}return[...n(this,T)]},mr=function(){console.log("Not implemented yet.")},yr=function(){console.log("Not implemented yet.")},an=function(){return n(this,L)!=="select"?[]:[...n(this,T)].filter(isLinearFeature)},wr=function(){o(this,a,an).call(this).forEach(t=>{t.direction=t.direction===PolylineDirection.FORWARD?PolylineDirection.BACKWARD:PolylineDirection.FORWARD,o(this,a,N).call(this,t)})},vr=function(){return n(this,L)!=="select"||n(this,T).size===1&&n(this,T).values().next().value instanceof Point?[]:[...n(this,T)]},br=function(){console.log("Not implemented yet.")},Sr=function(){return n(this,L)!=="select"?[]:[...n(this,T)].filter(t=>t instanceof LineString&&t.isNearlyStraight())},Er=function(){console.log("Not implemented yet.")},N=function(t){n(this,P).getSource(t.id).setData(t)},p(z,Si,"#00000000"),p(z,Ei,"#3bb2d0d0"),p(z,Pi,"#ff6d8bd0"),p(z,Ci,"#101010"),p(z,Li,"#e0e0e0"),p(z,kt,15),p(z,St,["step",["zoom"],!1,n(z,kt),!0]),p(z,Ee,["match",["get","selectionMode"],SelectionMode.SELECTED,n(z,Ei),SelectionMode.HOVERED,n(z,Pi),n(z,Si)]);let MapEditor=z;function isLinearFeature(s){return s instanceof LinearFeature}function initMapEditor(s){const t=new UnitType("length","Length"),e=new Unit(t,"mm");t.addUnit(e);const i=new Enum("track_level","Track Level",{surface:"Surface",tunnel:"Underground",bridge:"Bridge"}),r=new ObjectType("geometry","Geometry",null),l=new ObjectType("point","Point",r,"Point"),c=new ObjectType("linestring","Line",r,"LineString"),u=new ObjectType("polygon","Polygon",r,"Polygon"),h=new ObjectType("track_section","Track Section",c);h.addProperty(new EnumProperty(h,"level","Level",!0,!1,i));const d=new ObjectType("conventional_track_section","Railway Track Section",h);d.addProperty(new FloatProperty(d,"gauges","Gauge",!1,!1,0,void 0,t));const g=new MapEditor(s,{units:{length:t},enums:{track_level:i},objects:{geometry:r,point:l,linestring:c,polygon:u,track_section:h,conventional_track_section:d}}),v=new ObjectInstance(d);v.setPropertyValue("level","surface"),v.addValueToProperty("gauges",1435),s.on("load",()=>{g.createFeature({dbId:0,type:"Point",lng:1.45,lat:43.6005}),g.createFeature({dbId:1,type:"Point",lng:1.45,lat:43.6}),g.createFeature({dbId:2,type:"Point",lng:1.4505,lat:43.6}),g.createFeature({dbId:3,type:"Point",lng:1.4505,lat:43.6005}),g.createFeature({dbId:4,type:"Point",lng:1.4506,lat:43.601}),g.createFeature({dbId:5,type:"Point",lng:1.4505,lat:43.601}),g.createFeature({dbId:6,type:"Point",lng:1.451,lat:43.6015}),g.createFeature({dbId:7,type:"Point",lng:1.4515,lat:43.6015}),g.createFeature({dbId:8,type:"Point",lng:1.4508,lat:43.601}),g.createFeature({dbId:9,type:"Point",lng:1.451,lat:43.6013}),g.createFeature({dbId:100,type:"LineString",verticesDbIds:[1,2,3,4],dataObject:v}),g.createFeature({dbId:200,type:"Polygon",verticesDbIds:[[3,5,6,7],[4,8,9]]})})}function initMap(){const s=[c(window.ottm.translate("map.controls.layers.value.osm"),"osm","https://a.tile.openstreetmap.org/{z}/{x}/{y}.png",'Map data © <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'),c(window.ottm.translate("map.controls.layers.value.satellite_esri"),"arcgis","https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}","Tiles © Esri — Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"),c(window.ottm.translate("map.controls.layers.value.satellite_google"),"google","http://www.google.com/maps/vt?lyrs=s@189&x={x}&y={y}&z={z}","Tiles © Google",18)];if(!window.OTTM_MAP_CONFIG)throw new Error("Missing global OTTM_MAP_CONFIG object");const t=window.OTTM_MAP_CONFIG.edit,e=t?s[1]:s[0],i=new OttmMap({container:"map",antialias:!0,style:{name:"base",version:8,sources:{tiles:e.source},layers:[{id:"tiles",type:"raster",source:"tiles"}],transition:{duration:0}},center:[0,0],zoom:1});i.keyboard.disable(),i.addControl(new maplibreGlExports.ScaleControl({maxWidth:100,unit:"imperial"})),i.addControl(new maplibreGlExports.ScaleControl({maxWidth:100,unit:"metric"})),t?initMapEditor(i):i.addControl(new GeocoderControl({language:window.ottm.getPageLanguage().code,translator:(w,I)=>window.ottm.translate(w,I),searchButtonTitle:window.ottm.translate("map.controls.search.search_button.title"),eraseButtonTitle:window.ottm.translate("map.controls.search.erase_button.title"),placeholderText:window.ottm.translate("map.controls.search.placeholder"),noResultsMessage:window.ottm.translate("map.controls.search.no_results"),errorMessage:window.ottm.translate("map.controls.search.error")}),"top-left"),i.addControl(new TilesSourcesControl({title:window.ottm.translate("map.controls.layers.tooltip"),sources:s}),"top-left");let r;i.addControl(r=new ZoomControl({zoomInTitle:window.ottm.translate("map.controls.zoom_in.tooltip"),zoomOutTitle:window.ottm.translate("map.controls.zoom_out.tooltip")}),"top-right"),i.boxZoom.disable(),i.doubleClickZoom.disable();const l=window.ottm.config.get("staticPath");i.addControl(new OpenExternalMapControl({buttonTitle:window.ottm.translate("map.controls.google_maps_button.tooltip"),iconUrl:`${l}ottm/images/icons/GoogleMaps.png`,urlPattern:"https://www.google.com/maps/@{lat},{lng},{zoom}z",zoomMapping:w=>(w+1).toFixed(2)}),"top-right"),i.addControl(new OpenExternalMapControl({buttonTitle:window.ottm.translate("map.controls.bing_maps_button.tooltip"),iconUrl:`${l}ottm/images/icons/Bing.ico`,urlPattern:"https://www.bing.com/maps/?cp={lat}~{lng}&lvl={zoom}",zoomMapping:w=>(w+1).toFixed(1)}),"top-right"),i.addControl(new OpenExternalMapControl({buttonTitle:window.ottm.translate("map.controls.osm_button.tooltip"),iconUrl:`${l}ottm/images/icons/OSM.png`,urlPattern:"https://www.openstreetmap.org/#map={zoom}/{lat}/{lng}",zoomMapping:w=>(Math.round(w)+1).toString()}),"top-right"),i.addControl(new OpenExternalMapControl({buttonTitle:window.ottm.translate("map.controls.ohm_button.tooltip"),iconUrl:`${l}ottm/images/icons/OHM.ico`,urlPattern:"https://www.openhistoricalmap.org/#map={zoom}/{lat}/{lng}",zoomMapping:w=>(Math.round(w)+1).toString()}),"top-right"),i.addControl(new OpenExternalMapControl({buttonTitle:window.ottm.translate("map.controls.ign_compare_button.tooltip"),iconUrl:`${l}ottm/images/icons/IGN.ico`,urlPattern:"https://remonterletemps.ign.fr/comparer/basic?x={lng}&y={lat}&z={zoom}",zoomMapping:w=>(Math.round(w)+1).toString()}),"top-right"),i.addControl(new OpenExternalMapControl({buttonTitle:window.ottm.translate("map.controls.geohack_button.tooltip"),iconUrl:`${l}ottm/images/icons/WikimediaCloudServices.svg`,urlPattern:"https://geohack.toolforge.org/geohack.php?params={lat}_N_{lng}_E_scale:{zoom}",zoomMapping:w=>(108065732102457e-5*Math.exp(-.693992077826686*(w+2))).toFixed(5)}),"top-right"),i.addControl(new CompassControl({title:window.ottm.translate("map.controls.compass.tooltip")}),"top-right"),window.onhashchange=()=>{M()},i.on("zoomend",()=>{E();const w=i.getZoom();r.setZoomOutButtonDisabled(w===i.getMinZoom()),r.setZoomInButtonDisabled(w===i.getMaxZoom())}),i.on("moveend",()=>{E()}),i.on("resize",()=>{E()}),i.on("load",()=>{u(e),v().found?M():g(),delete window.OTTM_MAP_CONFIG,$$1("#ottm-map-config-script").remove()}),i.on("controls.styles.tiles_changed",w=>{u(w.source,!0)}),$$1("body").on("keydown",w=>{if(!i.textFieldHasFocus)switch(w.key){case"ArrowUp":i.panBy([0,-100]);break;case"ArrowDown":i.panBy([0,100]);break;case"ArrowLeft":i.panBy([-100,0]);break;case"ArrowRight":i.panBy([100,0]);break}}),i.hookTextFieldsFocusEvents();function c(w,I,U,A,W=19){return{label:w,id:I,source:{id:I,type:"raster",tiles:[U],tileSize:256,attribution:A,maxzoom:W}}}function u(w,I=!1){i.setMaxZoom(w.source.maxzoom),I&&E()}let h=!1,d=!1;function g(){navigator.permissions.query({name:"geolocation"}).then(w=>{switch(w.state){case"granted":case"prompt":navigator.geolocation.getCurrentPosition(I=>{i.setZoom(13),i.setCenter({lat:I.coords.latitude,lng:I.coords.longitude})},I=>{console.log(I.message),E()},{enableHighAccuracy:!1,maximumAge:3e4,timeout:2e4});break;default:case"denied":console.log("User does not allow geolocation"),E();break}},w=>{console.log(`Could not get geolocation: ${w}`),E()})}function v(){const w=/^#map=(\d+\.?\d*)\/(-?\d+\.?\d*)\/(-?\d+\.?\d*)$/.exec(window.location.hash);if(w){const I=i.getMinZoom(),U=i.getMaxZoom(),A=Math.max(I,Math.min(U,parseFloat(w[1]))),W=parseFloat(w[2]),G=parseFloat(w[3]);return{pos:[W,G,A],found:!0}}return{pos:[0,0,15],found:!1}}function E(){if(h)h=!1;else{d=!0;const w=i.getCenter(),I=w.lat.toFixed(5),U=w.lng.toFixed(5),W=`#map=${i.getZoom().toFixed(5)}/${I}/${U}`;window.location.hash=W;const G=["#nav-main-link","#nav-edit-link","#nav-history-link"];for(const J of G){const tt=$$1(J);if(!tt.length)continue;const ti=new URL(tt.prop("href"));ti.hash=W,tt.attr("href",ti.href)}window.ottm.setReferrer()}}function M(){if(d)d=!1;else{const{pos:[w,I,U],found:A}=v();A?(h=!0,i.setZoom(U),i.setCenter({lat:w,lng:I})):E()}}}function initEditor(){if(!window.ottm.user.get("useEditorSyntaxHighlighting"))return;const s=window.ottm.page.get("wContentType");if(typeof s!="string")throw new Error("Missing page content type");const t={js:"javascript",css:"css",json:"json",module:"python",wikipage:"text"}[s],e="wiki-ace-editor",r=$(`#${e}`).show().data("ace-target"),l=$(`#${r}`).hide(),c=window.ace.edit(e);c.setOptions({mode:`ace/mode/${t}`,useSoftTabs:!0,fontSize:16,minLines:20,maxLines:20}),c.setTheme(window.ottm.page.get("darkMode")?"ace/theme/monokai":"ace/theme/chrome"),c.getSession().setValue(l.val()),c.getSession().on("change",()=>l.val(c.getSession().getValue()).trigger("change")),$("#wiki-edit-form").on("submit",u=>{if(!$("#wiki-edit-form-comment").val().trim()&&window.ottm.user.get("warnWhenNoWikiEditComment")){const d=window.ottm.translate("wiki.edit.no_summary_warning");confirm(d)||u.preventDefault()}}),window.ottm.user.get("wCanEditPage")||c.setReadOnly(!0),window.wiki.editor=c}var Pe;class WikiGadget{constructor(t){b(this,"name");b(this,"version");p(this,Pe);if(!("name"in t))throw new Error('Missing "name" property in gadget');this.name=t.name,this.version=t.version,f(this,Pe,t),n(this,Pe).init()}run(){try{n(this,Pe).run()}catch(t){return console.error(t),!1}return!0}}Pe=new WeakMap;var Ce,se,Qe,Xe,Je,ln;class WikiGadgetManager{constructor(){p(this,Je);p(this,Ce,new Map);p(this,se,0);p(this,Qe,!1);p(this,Xe,!1)}registerGadget(gadgetName){if(n(this,Xe))throw new Error("Cannot register gadgets when manager is locked");console.log(`Registering gadget "${gadgetName}…"`),ri(this,se)._++;const apiPath=window.ottm.config.get("wApiPath");$.get(apiPath,{action:"query",query:"gadget",title:gadgetName},data=>{try{const gadget=new WikiGadget(eval(data));n(this,Ce).set(gadget.name,gadget)}catch(s){console.error(`Error while loading gadget "${gadgetName}":
${s}`)}ri(this,se)._--,n(this,se)===0&&n(this,Qe)&&o(this,Je,ln).call(this)})}finishRegistration(){f(this,Qe,!0),n(this,se)===0&&o(this,Je,ln).call(this)}getGadget(s){return n(this,Ce).get(s)}isGadgetRegistered(s){return n(this,Ce).get(s)!==void 0}}Ce=new WeakMap,se=new WeakMap,Qe=new WeakMap,Xe=new WeakMap,Je=new WeakSet,ln=function(){f(this,Xe,!0)};class WikiAPI{editPage(t,e){return Promise.reject(new Error("Not implemented"))}getPage(t){return Promise.reject(new Error("Not implemented"))}getPageCategories(t,e=!1){return Promise.reject(new Error("Not implemented"))}getCategories(t){return Promise.reject(new Error("Not implemented"))}parseWikicode(t){return Promise.reject(new Error("Not implemented"))}followPage(t){return Promise.reject(new Error("Not implemented"))}unfollowPage(t){return Promise.reject(new Error("Not implemented"))}}function initWiki(){window.wiki={gadgetsManager:new WikiGadgetManager,api:new WikiAPI,editor:null},$(".hljs").each((t,e)=>{window.hljs.highlightElement(e)});const s=window.ottm.page.get("wAction");(s==="edit"||s==="submit")&&initEditor()}window.ottm=new OTTM;hookSettingsDropdownBehavior();hookDarkModeCallback();hookLanguageSelectorCallback();initForms();$$1("#user-settings").length!==0&&setupUserSettings();window.OTTM_MAP_CONFIG&&initMap();window.location.pathname.startsWith("/wiki/")&&initWiki();window.ottm.setReferrer();setAccessKeys();function hookSettingsDropdownBehavior(){const s=$$1("#navbar-logged-out-settings");if(s.length){const t=s.parent(),e=t.find(".dropdown-menu");s.on("click",i=>{t.toggleClass("show"),e.toggleClass("show"),i.preventDefault()}),$$1("body").on("click",i=>{$$1.contains(t[0],i.target)||(t.removeClass("show"),e.removeClass("show"))})}}function hookDarkModeCallback(){$$1("#dark-mode-checkbox").on("click",s=>{api.set("dark_mode",$$1(s.target).prop("checked")),location.reload()})}function hookLanguageSelectorCallback(){$$1("#nav-language-select").on("change",s=>{api.set("language",$$1(s.target).val()),location.reload()})}function initForms(){$$1("form div.form-group").each((t,e)=>{const i=$$1(e);i.find("div.invalid-feedback").length&&i.find("input").addClass("is-invalid")});function s(t,e){function i(){t.val()!==e.val()?(t.addClass("is-invalid"),e.addClass("is-invalid")):(t.removeClass("is-invalid"),e.removeClass("is-invalid"))}t.on("keyup",i),e.on("keyup",i)}location.pathname==="/sign-up"?s($$1("#sign-up-form-password"),$$1("#sign-up-form-password-confirm")):location.pathname==="/user/settings"&&s($$1("#user-settings-form-password"),$$1("#user-settings-form-password-confirm")),$$1("form input[name='warn-unsaved']").each((t,e)=>{hookExitConfirm($$1(e).closest("form"))})}function setAccessKeys(){$$1("*[accesskey]").each((s,t)=>{const e=$$1(t),i=e.attr("accesskey");if(i){const r=e.attr("title"),l="["+window.ottm.formatShortcut("Alt","Shift",i)+"]";e.attr("title",(r?r+" ":"")+l)}})}
