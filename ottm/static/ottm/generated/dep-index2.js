const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["css/monokai.css","css/vs.css"])))=>i.map(i=>d[i]);
var j=Object.defineProperty;var v=t=>{throw TypeError(t)};var N=(t,e,i)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var p=(t,e,i)=>N(t,typeof e!="symbol"?e+"":e,i),f=(t,e,i)=>e.has(t)||v("Cannot "+i);var r=(t,e,i)=>(f(t,e,"read from private field"),i?i.call(t):e.get(t)),o=(t,e,i)=>e.has(t)?v("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),m=(t,e,i,g)=>(f(t,e,"write to private field"),g?g.call(t,i):e.set(t,i),i),k=(t,e,i)=>(f(t,e,"access private method"),i);var _=(t,e,i,g)=>({set _(u){m(t,e,u,i)},get _(){return r(t,e,g)}});import{_ as __vitePreload}from"./index.js";import{$}from"./dep-jquery.js";import{H as HighlightJS}from"./dep-hljs.js";import{a as ace}from"./dep-ace.js";import"./dep-maplibre-gl.js";function initEditor(){if(!window.ottm.user.get("useEditorSyntaxHighlighting"))return;const t=window.ottm.page.get("wContentType");if(typeof t!="string")throw new Error("Missing page content type");const e={js:"javascript",css:"css",json:"json",module:"python",wikipage:"text"}[t],i="wiki-ace-editor",u=$(`#${i}`).show().data("ace-target"),E=$(`#${u}`).hide(),d=ace.edit(i);d.setOptions({mode:`ace/mode/${e}`,useSoftTabs:!0,fontSize:16,minLines:20,maxLines:20}),d.setTheme(window.ottm.page.get("darkMode")?"ace/theme/monokai":"ace/theme/chrome");const h=d.getSession();h.setValue(E.val()??""),h.on("change",()=>{E.val(h.getValue()).trigger("change")}),$("#wiki-edit-form").on("submit",y=>{if(!($("#wiki-edit-form-comment").val()??"").trim()&&window.ottm.user.get("warnWhenNoWikiEditComment")){const W=window.ottm.translate("wiki.edit.no_summary_warning");confirm(W)||y.preventDefault()}}),window.ottm.user.get("wCanEditPage")||d.setReadOnly(!0),window.wiki.editor=d}var a;class WikiGadget{constructor(e){p(this,"name");p(this,"version");o(this,a);if(!("name"in e))throw new Error('Missing "name" property in gadget');this.name=e.name,this.version=e.version,m(this,a,e),r(this,a).init()}run(){try{r(this,a).run()}catch(e){return console.error(e),!1}return!0}}a=new WeakMap;var s,n,c,l,w,P;class WikiGadgetManager{constructor(){o(this,w);o(this,s,new Map);o(this,n,0);o(this,c,!1);o(this,l,!1)}registerGadget(gadgetName){if(r(this,l))throw new Error("Cannot register gadgets when manager is locked");console.log(`Registering gadget "${gadgetName}â€¦"`),_(this,n)._++;const apiPath=window.ottm.config.get("wApiPath");$.get(apiPath,{action:"query",query:"gadget",title:gadgetName},data=>{try{const gadget=new WikiGadget(eval(data));r(this,s).set(gadget.name,gadget)}catch(t){console.error(`Error while loading gadget "${gadgetName}":
${t}`)}_(this,n)._--,r(this,n)===0&&r(this,c)&&k(this,w,P).call(this)})}finishRegistration(){m(this,c,!0),r(this,n)===0&&k(this,w,P).call(this)}getGadget(t){return r(this,s).get(t)}isGadgetRegistered(t){return r(this,s).get(t)!==void 0}}s=new WeakMap,n=new WeakMap,c=new WeakMap,l=new WeakMap,w=new WeakSet,P=function(){m(this,l,!0)};class WikiAPI{editPage(e,i){return Promise.reject(new Error("Not implemented"))}getPage(e){return Promise.reject(new Error("Not implemented"))}getPageCategories(e,i=!1){return Promise.reject(new Error("Not implemented"))}getCategories(e){return Promise.reject(new Error("Not implemented"))}parseWikicode(e){return Promise.reject(new Error("Not implemented"))}followPage(e){return Promise.reject(new Error("Not implemented"))}unfollowPage(e){return Promise.reject(new Error("Not implemented"))}}async function initWiki(){window.wiki={gadgetsManager:new WikiGadgetManager,api:new WikiAPI,editor:null},window.ottm.page.get("darkMode")?await __vitePreload(()=>Promise.resolve({}),__vite__mapDeps([0])):await __vitePreload(()=>Promise.resolve({}),__vite__mapDeps([1])),$(".hljs").each((e,i)=>{HighlightJS.highlightElement(i)});const t=window.ottm.page.get("wAction");(t==="edit"||t==="submit")&&initEditor()}export{WikiAPI,WikiGadget,WikiGadgetManager,initWiki as default};
