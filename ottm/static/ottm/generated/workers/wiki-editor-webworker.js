var U=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function B(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var _={exports:{}};(function(h,R){(function(E,p){h.exports=p()})(U,()=>(()=>{var H={2032:(f,i,t)=>{t.d(i,{Go:()=>a});var a;(function(e){e[e.init=0]="init",e[e.format=1]="format",e[e.complete=2]="complete",e[e.resolveCompletion=3]="resolveCompletion",e[e.change=4]="change",e[e.hover=5]="hover",e[e.validate=6]="validate",e[e.applyDelta=7]="applyDelta",e[e.changeMode=8]="changeMode",e[e.changeOptions=9]="changeOptions",e[e.closeDocument=10]="closeDocument",e[e.globalOptions=11]="globalOptions",e[e.configureFeatures=12]="configureFeatures",e[e.signatureHelp=13]="signatureHelp",e[e.documentHighlight=14]="documentHighlight",e[e.closeConnection=15]="closeConnection",e[e.capabilitiesChange=16]="capabilitiesChange",e[e.getSemanticTokens=17]="getSemanticTokens",e[e.getCodeActions=18]="getCodeActions",e[e.executeCommand=19]="executeCommand",e[e.applyEdit=20]="applyEdit",e[e.appliedEdit=21]="appliedEdit",e[e.setWorkspace=22]="setWorkspace"})(a||(a={}))},7770:(f,i,t)=>{t.d(i,{rL:()=>a,z2:()=>r});function a(n,s,m=!1){if(!n)return s;if(!s)return n;m&&(n=e(n),s=e(s));const d={...s,...n};for(const u of Object.keys(d))n[u]&&s[u]&&(Array.isArray(n[u])?d[u]=n[u].concat(s[u]):Array.isArray(s[u])?d[u]=s[u].concat(n[u]):typeof n[u]=="object"&&typeof s[u]=="object"&&(d[u]=a(n[u],s[u])));return d}function e(n){const s=Object.entries(n).filter(([m,d])=>d!==void 0);return Object.fromEntries(s)}function r(n){return n!=null}}},E={};function p(f){var i=E[f];if(i!==void 0)return i.exports;var t=E[f]={exports:{}};return H[f](t,t.exports,p),t.exports}p.d=(f,i)=>{for(var t in i)p.o(i,t)&&!p.o(f,t)&&Object.defineProperty(f,t,{enumerable:!0,get:i[t]})},p.o=(f,i)=>Object.prototype.hasOwnProperty.call(f,i),p.r=f=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})};var x={};p.r(x),p.d(x,{ServiceManager:()=>F});var D=p(7770),c=p(2032);function C(f,i,t){return i in f?Object.defineProperty(f,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):f[i]=t,f}class F{async getServicesCapabilitiesAfterCallback(i,t,a){let e=await a(i,t.value,t.mode,t.options);if(e)return Object.keys(e).reduce((r,n)=>{var s,m;return r[n]=((m=e[n])===null||m===void 0||(s=m.serviceInstance)===null||s===void 0?void 0:s.serviceCapabilities)||null,r},{})}async aggregateFeatureResponses(i,t,a,e,r){return(await Promise.all(this.filterByFeature(i,t).map(async n=>Array.isArray(r)?n[a](e,...r):n[a](e,r)))).filter(D.z2)}applyOptionsToServices(i,t,a){i.forEach(e=>{e.setOptions(t,a)})}async closeAllConnections(){var i=this.$services;for(let e in i){var t,a;await((a=i[e])===null||a===void 0||(t=a.serviceInstance)===null||t===void 0?void 0:t.closeConnection())}}static async $initServiceInstance(i,t,a){let e;if("type"in i)if(["socket","webworker"].includes(i.type))e=await i.module(),i.serviceInstance=new e.LanguageClient(i,t,a);else throw"Unknown service type";else e=await i.module(),i.serviceInstance=new e[i.className](i.modes);if(i.options||i.initializationOptions){var r,n;i.serviceInstance.setGlobalOptions((n=(r=i.options)!==null&&r!==void 0?r:i.initializationOptions)!==null&&n!==void 0?n:{})}return i.serviceInstance.serviceData=i,i.serviceInstance}async $getServicesInstancesByMode(i){let t=this.findServicesByMode(i);if(Object.keys(t).length===0)return[];for(let a in t)await this.initializeService(a);return t}async initializeService(i){let t=this.$services[i];return t.serviceInstance?(t.serviceInstance.serviceName||(t.serviceInstance.serviceName=i),t.serviceInstance):(this.serviceInitPromises[t.id]||(this.serviceInitPromises[t.id]=F.$initServiceInstance(t,this.ctx,this.workspaceUri).then(a=>(t.serviceInstance=a,t.serviceInstance.serviceName=i,delete this.serviceInitPromises[t.id],a))),this.serviceInitPromises[t.id])}setGlobalOptions(i,t,a=!1){let e=this.$services[i];e&&(e.options=a?(0,D.rL)(t,e.options):t,e.serviceInstance&&e.serviceInstance.setGlobalOptions(e.options))}setWorkspace(i){this.workspaceUri=i,Object.values(this.$services).forEach(t=>{var a;(a=t.serviceInstance)===null||a===void 0||a.setWorkspace(this.workspaceUri)})}async addDocument(i,t,a,e){if(!a||!/^ace\/mode\//.test(a))return;a=a.replace("ace/mode/",""),a=a.replace(/golang$/,"go");let r=await this.$getServicesInstancesByMode(a);if(Object.keys(r).length===0)return;let n={uri:i.uri,version:i.version,languageId:a,text:t};return Object.values(r).forEach(s=>s.serviceInstance.addDocument(n)),this.$sessionIDToMode[i.uri]=a,r}async changeDocumentMode(i,t,a,e){return this.removeDocument(i),await this.addDocument(i,t,a,e)}removeDocument(i){let t=this.getServicesInstances(i.uri);t.length>0&&(t.forEach(a=>a.removeDocument(i)),delete this.$sessionIDToMode[i.uri])}getServicesInstances(i){let t=this.$sessionIDToMode[i];if(!t)return[];let a=this.findServicesByMode(t);return Object.values(a).map(e=>e.serviceInstance).filter(D.z2)}filterByFeature(i,t){return i.filter(a=>{if(!a.serviceData.features[t])return!1;const e=a.serviceCapabilities;switch(t){case"hover":return e.hoverProvider==!0;case"completion":return e.completionProvider!=null;case"completionResolve":var r;return((r=e.completionProvider)===null||r===void 0?void 0:r.resolveProvider)===!0;case"format":return e.documentRangeFormattingProvider==!0||e.documentFormattingProvider==!0;case"diagnostics":return e.diagnosticProvider!=null;case"signatureHelp":return e.signatureHelpProvider!=null;case"documentHighlight":return e.documentHighlightProvider==!0;case"semanticTokens":return e.semanticTokensProvider!=null;case"codeAction":return e.codeActionProvider!=null;case"executeCommand":return e.executeCommandProvider!=null}})}findServicesByMode(i){let t={};return Object.entries(this.$services).forEach(([a,e])=>{e.modes.split("|").includes(i)&&(t[a]=this.$services[a])}),t}registerService(i,t){t.id=i,t.features=this.setDefaultFeaturesState(t.features),this.$services[i]=t}registerServer(i,t){t.id=i,t.className="LanguageClient",t.features=this.setDefaultFeaturesState(t.features),this.$services[i]=t}configureFeatures(i,t){t=this.setDefaultFeaturesState(t),this.$services[i]&&(this.$services[i].features=t)}setDefaultFeaturesState(i){var t,a,e,r,n,s,m,d,u,v;let o=i??{};var l;(l=(t=o).hover)!==null&&l!==void 0||(t.hover=!0);var b;(b=(a=o).completion)!==null&&b!==void 0||(a.completion=!0);var w;(w=(e=o).completionResolve)!==null&&w!==void 0||(e.completionResolve=!0);var k;(k=(r=o).format)!==null&&k!==void 0||(r.format=!0);var S;(S=(n=o).diagnostics)!==null&&S!==void 0||(n.diagnostics=!0);var O;(O=(s=o).signatureHelp)!==null&&O!==void 0||(s.signatureHelp=!0);var I;(I=(m=o).documentHighlight)!==null&&I!==void 0||(m.documentHighlight=!0);var P;(P=(d=o).semanticTokens)!==null&&P!==void 0||(d.semanticTokens=!0);var G;(G=(u=o).codeAction)!==null&&G!==void 0||(u.codeAction=!0);var y;return(y=(v=o).executeCommand)!==null&&y!==void 0||(v.executeCommand=!0),o}constructor(i){C(this,"$services",{}),C(this,"serviceInitPromises",{}),C(this,"$sessionIDToMode",{}),C(this,"ctx",void 0),C(this,"workspaceUri",void 0),this.ctx=i;let t=async(e,r)=>{if(r??(r=this.getServicesInstances(e.uri)),r.length===0)return;let n=Object.keys(r[0].documents);if(r=this.filterByFeature(r,"diagnostics"),r=r.filter(d=>d.serviceCapabilities.diagnosticProvider),r.length===0)return;let s={type:c.Go.validate};for(let d of n){var m;let u=(m=await Promise.all(r.map(v=>v.doValidation({uri:d}))))!==null&&m!==void 0?m:[];s.documentUri=d,s.value=u.flat(),i.postMessage(s)}},a=async e=>{let r=this.$services[e];if(r){var n=r.serviceInstance;n&&await t(void 0,[n])}};i.addEventListener("message",async e=>{let r=e.data;var n;let s=(n=r.sessionId)!==null&&n!==void 0?n:"";var m;let d=(m=r.documentUri)!==null&&m!==void 0?m:"",u=r.version,v={type:r.type,sessionId:s,callbackId:r.callbackId},o=this.getServicesInstances(d),l={uri:d,version:u};switch(r.type){case c.Go.format:o=this.filterByFeature(o,"format"),o.length>0&&(v.value=await o[0].format(l,r.value,r.format));break;case c.Go.complete:v.value=(await Promise.all(this.filterByFeature(o,"completion").map(async g=>({completions:await g.doComplete(l,r.value),service:g.serviceData.className})))).filter(D.z2);break;case c.Go.resolveCompletion:var b;let I=r.value.service;v.value=await((b=this.filterByFeature(o,"completionResolve").find(g=>{if(g.serviceData.className===I)return g}))===null||b===void 0?void 0:b.doResolve(r.value));break;case c.Go.change:o.forEach(g=>{g.setValue(l,r.value)}),await t(l,o);break;case c.Go.applyDelta:o.forEach(g=>{g.applyDeltas(l,r.value)}),await t(l,o);break;case c.Go.hover:v.value=await this.aggregateFeatureResponses(o,"hover","doHover",l,r.value);break;case c.Go.validate:v.value=await t(l,o);break;case c.Go.init:v.value=await this.getServicesCapabilitiesAfterCallback(l,r,this.addDocument.bind(this)),await t(l);break;case c.Go.changeMode:v.value=await this.getServicesCapabilitiesAfterCallback(l,r,this.changeDocumentMode.bind(this)),await t(l);break;case c.Go.changeOptions:this.applyOptionsToServices(o,d,r.options),await t(l,o);break;case c.Go.closeDocument:this.removeDocument(l),await t(l,o);break;case c.Go.closeConnection:await this.closeAllConnections();break;case c.Go.globalOptions:this.setGlobalOptions(r.serviceName,r.options,r.merge),await a(r.serviceName);break;case c.Go.configureFeatures:this.configureFeatures(r.serviceName,r.options),await a(r.serviceName);break;case c.Go.signatureHelp:v.value=await this.aggregateFeatureResponses(o,"signatureHelp","provideSignatureHelp",l,r.value);break;case c.Go.documentHighlight:let P=await this.aggregateFeatureResponses(o,"documentHighlight","findDocumentHighlights",l,r.value);v.value=P.flat();break;case c.Go.getSemanticTokens:o=this.filterByFeature(o,"semanticTokens"),o.length>0&&(v.value=await o[0].getSemanticTokens(l,r.value));break;case c.Go.getCodeActions:let G=r.value,y=r.context;v.value=(await Promise.all(this.filterByFeature(o,"codeAction").map(async g=>({codeActions:await g.getCodeActions(l,G,y),service:g.serviceName})))).filter(D.z2);break;case c.Go.executeCommand:var w,k;v.value=(k=this.$services[r.serviceName])===null||k===void 0||(w=k.serviceInstance)===null||w===void 0?void 0:w.executeCommand(r.value,r.args);break;case c.Go.appliedEdit:var S,O;v.value=(O=this.$services[r.serviceName])===null||O===void 0||(S=O.serviceInstance)===null||S===void 0?void 0:S.sendAppliedResult(r.value,r.callbackId);break;case c.Go.setWorkspace:this.setWorkspace(r.value);break}i.postMessage(v)})}}return x})())})(_);var $=_.exports;const A=new $.ServiceManager(self);A.registerService("css",{module:()=>import("./dep-css-service.js").then(function(h){return h.c}),className:"CssService",modes:"css"});A.registerService("javascript",{module:()=>import("./dep-javascript-service.js").then(function(h){return h.j}),className:"JavascriptService",modes:"javascript"});A.registerService("json",{module:()=>import("./dep-json-service.js").then(function(h){return h.j}),className:"JsonService",modes:"json"});A.registerService("python",{module:()=>import("./dep-python-service.js").then(function(h){return h.p}),className:"PythonService",modes:"python"});export{U as c,B as g};
//# sourceMappingURL=wiki-editor-webworker.js.map
